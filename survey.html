<!DOCTYPE html>
<!--
California Voter Opinion Survey 2025
Production-ready survey system with advanced features:
- Persistent progress saving
- Response validation and security
- Mobile-optimized responsive design
- Accessibility features
- Privacy-focused data handling
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="description" content="Share your voice on important California issues. Official voter opinion research survey.">
    <meta name="theme-color" content="#1e3a8a">
    <title>California Voter Opinion Survey 2025</title>
    
    <!-- Preconnect to external resources for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Fonts and Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f7f9fc;
            color: #1a1a1a;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
            overflow-x: hidden;
        }
        
        html {
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 10% 20%, rgba(91, 173, 254, 0.03) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(91, 173, 254, 0.03) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }
        
        .survey-container {
            max-width: 720px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            z-index: 1;
            width: 100%;
        }
        
        .progress-bar-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #f8fafc 0%, #f1f5f9 50%, #f8fafc 100%);
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.8);
            transition: opacity 0.5s ease-out;
            border-bottom: 1px solid rgba(30, 58, 138, 0.08);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #1e3a8a 0%, #1e40af 50%, #1e3a8a 100%);
            width: 0%;
            transition: width 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 0 20px rgba(30, 58, 138, 0.4), 0 2px 8px rgba(30, 58, 138, 0.3);
            position: relative;
            overflow: hidden;
            will-change: width;
        }
        
        /* Leading edge glow */
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6));
            filter: blur(6px);
        }
        
        /* Shimmer effect */
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 120px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.3) 30%,
                rgba(255, 255, 255, 0.5) 50%, 
                rgba(255, 255, 255, 0.3) 70%,
                transparent 100%);
            animation: shimmer 2.5s ease-in-out infinite;
        }
        
        /* Smooth shimmer only */
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            position: fixed;
            top: 20px;
            right: 28px;
            font-size: 14px;
            color: #1e3a8a;
            font-weight: 700;
            background: linear-gradient(135deg, white 0%, #f8fafc 100%);
            padding: 12px 24px;
            border-radius: 28px;
            box-shadow: 0 4px 16px rgba(30, 58, 138, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
            z-index: 1001;
            border: 2px solid rgba(30, 58, 138, 0.15);
            letter-spacing: 0.5px;
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            backdrop-filter: blur(8px);
            transform-origin: center;
        }
        
        .progress-text::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.1), rgba(59, 130, 246, 0.1));
            border-radius: 28px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }
        
        /* Removed chunky milestone effects for smooth flow */
        
        .dev-tools {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1001;
        }
        
        .page {
            background: white;
            border-radius: 16px;
            padding: 56px 48px;
            margin-top: 100px;
            margin-bottom: 40px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 20px 60px rgba(0, 0, 0, 0.06);
            border: 1px solid #e8eef5;
            opacity: 0;
            animation: fadeIn 0.12s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            position: relative;
            will-change: opacity;
        }
        
        .page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 0;
            background: transparent;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }
        
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(-20px);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        @keyframes slideDown {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .page.fade-out {
            animation: fadeOut 0.08s cubic-bezier(0.4, 0, 1, 1) forwards;
        }
        
        @keyframes fadeOut {
            to {
                opacity: 0;
            }
        }
        
        h1 {
            font-size: 28px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
            line-height: 1.3;
            letter-spacing: -0.01em;
        }
        
        h2 {
            font-size: 22px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 12px;
            letter-spacing: -0.01em;
        }
        
        p {
            font-size: 16px;
            color: #444;
            margin-bottom: 16px;
            line-height: 1.7;
        }
        
        .intro-box {
            background: #f8fafc;
            border-left: 3px solid #1e3a8a;
            padding: 24px;
            margin: 24px 0;
            border-radius: 12px;
            border: 1px solid #e8eef5;
            border-left-width: 3px;
        }
        
        .intro-box h3 {
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #0f0f0f;
            letter-spacing: -0.01em;
        }
        
        .intro-box ul {
            list-style: none;
            padding: 0;
        }
        
        .intro-box li {
            padding: 8px 0;
            font-size: 15px;
            color: #333;
            line-height: 1.6;
        }
        
        .intro-box li strong {
            color: #0f0f0f;
            font-weight: 600;
        }
        
        .privacy-notice {
            background: #fffdf7;
            border: 1px solid #fde68a;
            padding: 20px;
            border-radius: 12px;
            margin: 24px 0;
            font-size: 14px;
            color: #78716c;
            line-height: 1.7;
        }
        
        .privacy-notice strong {
            color: #333;
            font-weight: 600;
        }
        
        /* Premium Welcome Page Styles */
        .welcome-hero {
            text-align: center;
            padding: 0 0 32px 0;
            border-bottom: 1px solid #e8eef5;
            margin-bottom: 32px;
        }
        
        .welcome-badge {
            display: inline-block;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1.2px;
            padding: 8px 20px;
            border-radius: 20px;
            margin-bottom: 24px;
            text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
        }
        
        .welcome-title {
            font-size: 42px;
            font-weight: 800;
            color: #0f0f0f;
            line-height: 1.15;
            letter-spacing: -0.03em;
            margin-bottom: 16px;
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: #64748b;
            font-weight: 500;
            letter-spacing: -0.01em;
            margin-bottom: 0;
        }
        
        .welcome-stats {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            padding: 32px 0;
            border-bottom: 1px solid #e8eef5;
            margin-bottom: 32px;
        }
        
        .stat-item {
            text-align: center;
            padding: 0 32px;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 800;
            color: #1e3a8a;
            line-height: 1;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }
        
        .stat-label {
            font-size: 13px;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-divider {
            width: 1px;
            height: 48px;
            background: linear-gradient(to bottom, transparent, #e8eef5 20%, #e8eef5 80%, transparent);
        }
        
        .eligibility-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #1e3a8a;
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.08);
        }
        
        .eligibility-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            color: #1e3a8a;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: -0.01em;
        }
        
        .eligibility-header svg {
            flex-shrink: 0;
        }
        
        .eligibility-items {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .eligibility-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        
        .eligibility-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #1e3a8a;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
        }
        
        .eligibility-text {
            flex: 1;
            padding-top: 2px;
        }
        
        .eligibility-text strong {
            display: block;
            font-size: 15px;
            font-weight: 700;
            color: #0f0f0f;
            margin-bottom: 4px;
            letter-spacing: -0.01em;
        }
        
        .eligibility-text span {
            display: block;
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }
        
        .privacy-card {
            background: white;
            border: 1px solid #e8eef5;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .privacy-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            color: #0f0f0f;
            font-size: 15px;
            font-weight: 700;
            letter-spacing: -0.01em;
        }
        
        .privacy-header svg {
            color: #64748b;
            flex-shrink: 0;
        }
        
        .privacy-text {
            font-size: 14px;
            color: #64748b;
            line-height: 1.7;
            margin: 0;
        }
        
        .consent-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #bae6fd;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 28px;
        }
        
        .consent-title {
            font-size: 15px;
            font-weight: 700;
            color: #0f0f0f;
            margin-bottom: 16px;
            letter-spacing: -0.01em;
        }
        
        .consent-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .consent-check {
            font-size: 14px;
            color: #0c4a6e;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .consent-check::before {
            content: '';
            flex-shrink: 0;
        }
        
        .welcome-cta {
            width: 100%;
            font-size: 16px;
            font-weight: 700;
            padding: 18px 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .welcome-cta svg {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .welcome-cta:hover svg {
            transform: translateX(4px);
        }
        
        .welcome-cta:active {
            transform: scale(0.98);
        }
        
        .question-text {
            font-size: 26px;
            font-weight: 700;
            color: #0f0f0f;
            margin-bottom: 40px;
            line-height: 1.35;
            letter-spacing: -0.02em;
            position: relative;
            padding-bottom: 24px;
        }
        
        .question-text::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, #1e3a8a 0%, #3b82f6 100%);
            border-radius: 2px;
        }
        
        /* Prop 50 Argument & Info Boxes */
        .prop50-info-box,
        .prop50-argument-box {
            background: white;
            border-radius: 16px;
            padding: 24px 28px;
            margin: 0 0 32px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.03);
        }
        
        .prop50-info-box {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #cbd5e1;
        }
        
        .prop50-argument-box.prop50-supporters {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border: 2px solid #86efac;
            border-left: 4px solid #10b981;
        }
        
        .prop50-argument-box.prop50-opponents {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #fca5a5;
            border-left: 4px solid #ef4444;
        }
        
        .prop50-info-header,
        .prop50-argument-header {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .prop50-info-header {
            color: #64748b;
        }
        
        .prop50-argument-box.prop50-supporters .prop50-argument-header {
            color: #059669;
        }
        
        .prop50-argument-box.prop50-opponents .prop50-argument-header {
            color: #dc2626;
        }
        
        .prop50-info-header i,
        .prop50-argument-header i {
            font-size: 14px;
        }
        
        .prop50-info-content,
        .prop50-argument-content {
            font-size: 16px;
            line-height: 1.7;
            font-weight: 500;
            color: #1e293b;
        }
        
        .prop50-argument-box.prop50-opponents .prop50-argument-content {
            color: #7f1d1d;
        }
        
        .prop50-argument-box.prop50-supporters .prop50-argument-content {
            color: #064e3b;
        }
        
        .question-number {
            font-size: 13px;
            color: #1e3a8a;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            display: block;
        }
        
        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .answer-option {
            position: relative;
            opacity: 0;
            animation: slideIn 0.12s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        .answer-option:nth-child(1) { animation-delay: 0s; }
        .answer-option:nth-child(2) { animation-delay: 0s; }
        .answer-option:nth-child(3) { animation-delay: 0s; }
        .answer-option:nth-child(4) { animation-delay: 0s; }
        .answer-option:nth-child(5) { animation-delay: 0s; }
        .answer-option:nth-child(6) { animation-delay: 0s; }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(4px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .answer-option input[type="radio"],
        .answer-option input[type="checkbox"] {
            position: absolute;
            opacity: 0;
        }
        
        .answer-option label {
            display: block;
            padding: 20px 60px 20px 24px;
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.08s ease;
            font-size: 16px;
            color: #1f2937;
            user-select: none;
            font-weight: 500;
            position: relative;
        }
        
        .answer-option label:hover {
            border-color: #cbd5e1;
            background: #f8fafc;
        }
        
        /* Removed - JavaScript handles all visual feedback now */
        
        .answer-option input[type="checkbox"]:checked + label::after {
            content: '✓';
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%) scale(0);
            font-size: 24px;
            font-weight: 900;
            color: white;
            animation: checkPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        @keyframes checkPop {
            0% {
                transform: translateY(-50%) translateZ(0) scale(0) rotate(-45deg);
                opacity: 0;
            }
            60% {
                transform: translateY(-50%) translateZ(0) scale(1.12) rotate(3deg);
            }
            100% {
                transform: translateY(-50%) translateZ(0) scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        @keyframes checkmarkPop {
            0% {
                transform: translateY(-50%) translateZ(0) scale(0) rotate(-20deg);
                opacity: 0;
            }
            50% {
                transform: translateY(-50%) translateZ(0) scale(1.1) rotate(5deg);
            }
            100% {
                transform: translateY(-50%) translateZ(0) scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        @keyframes answerSelected {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes progressMilestone {
            0% {
                transform: scaleX(1);
            }
            50% {
                transform: scaleX(1.01);
                filter: brightness(1.15);
            }
            100% {
                transform: scaleX(1);
            }
        }
        
        @keyframes sparkle {
            0% {
                opacity: 0;
                left: 0%;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                left: 100%;
            }
        }
        
        .answer-option input[type="radio"]:focus + label,
        .answer-option input[type="checkbox"]:focus + label {
            outline: 3px solid rgba(37, 99, 235, 0.3);
            outline-offset: 2px;
        }
        
        .button-primary {
            background: #1e3a8a;
            color: white;
            border: none;
            padding: 18px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.08s ease;
            width: 100%;
            margin-top: 32px;
            letter-spacing: 0;
            position: relative;
            box-shadow: 0 4px 14px rgba(30, 58, 138, 0.25);
        }
        
        .button-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .button-primary:hover::before {
            left: 100%;
        }
        
        .button-primary:hover {
            background: #1d4ed8;
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.3);
        }
        
        .button-primary:active {
            background: #1e40af;
            transform: translateY(1px);
        }
        
        .button-primary:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .footer-text {
            text-align: center;
            font-size: 13px;
            color: #999;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid #e0e0e0;
        }
        
        .footer-text a {
            color: #0066cc;
            text-decoration: none;
        }
        
        .footer-text a:hover {
            text-decoration: underline;
        }
        
        /* Premium Thank You Page */
        .thank-you-container {
            text-align: center;
            padding: 20px;
        }
        
        .success-animation {
            margin: 0 auto 32px;
            animation: successFadeIn 0.6s ease-out;
        }
        
        @keyframes successFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .success-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            position: relative;
        }
        
        .success-checkmark {
            width: 100%;
            height: 100%;
        }
        
        .success-circle-path {
            stroke-dasharray: 240;
            stroke-dashoffset: 240;
            animation: drawCircle 0.6s ease-out 0.1s forwards;
        }
        
        @keyframes drawCircle {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        .success-check-path {
            stroke-dasharray: 80;
            stroke-dashoffset: 80;
            animation: drawCheck 0.4s ease-out 0.5s forwards;
        }
        
        @keyframes drawCheck {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        .thank-you-title {
            font-size: 36px;
            font-weight: 800;
            color: #0f0f0f;
            margin-bottom: 12px;
            letter-spacing: -0.02em;
            animation: slideUp 0.5s ease-out 0.3s both;
        }
        
        .thank-you-subtitle {
            font-size: 18px;
            color: #64748b;
            font-weight: 500;
            margin-bottom: 40px;
            animation: slideUp 0.5s ease-out 0.4s both;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .completion-stats {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            padding: 32px 0;
            margin-bottom: 40px;
            border-top: 1px solid #e8eef5;
            border-bottom: 1px solid #e8eef5;
            animation: slideUp 0.5s ease-out 0.5s both;
        }
        
        .completion-stat {
            text-align: center;
            padding: 0 40px;
        }
        
        .completion-number {
            font-size: 40px;
            font-weight: 800;
            background: linear-gradient(135deg, #3b82f6 0%, #1e3a8a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .completion-label {
            font-size: 13px;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .completion-divider {
            width: 1px;
            height: 60px;
            background: linear-gradient(to bottom, transparent, #e8eef5 20%, #e8eef5 80%, transparent);
        }
        
        .thank-you-message {
            max-width: 600px;
            margin: 0 auto 40px;
            animation: slideUp 0.5s ease-out 0.6s both;
        }
        
        .thank-you-message p {
            font-size: 16px;
            color: #475569;
            line-height: 1.7;
            margin-bottom: 16px;
        }
        
        .privacy-reminder {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 1px solid #bfdbfe;
            border-radius: 12px;
            padding: 20px 24px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
            text-align: left;
            max-width: 600px;
            margin: 0 auto;
            animation: slideUp 0.5s ease-out 0.7s both;
        }
        
        .privacy-reminder svg {
            color: #3b82f6;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .privacy-reminder strong {
            display: block;
            font-size: 15px;
            font-weight: 700;
            color: #0f0f0f;
            margin-bottom: 6px;
        }
        
        .privacy-reminder span {
            display: block;
            font-size: 14px;
            color: #166534;
            line-height: 1.6;
        }
        
        .thank-you-box {
            text-align: center;
            padding: 40px 20px;
        }
        
        .thank-you-box h1 {
            font-size: 32px;
            margin-bottom: 20px;
        }
        
        .thank-you-icon {
            font-size: 64px;
            margin-bottom: 24px;
        }
        
        .screen-out-box {
            text-align: center;
            padding: 60px 20px;
            max-width: 620px;
            margin: 0 auto;
        }
        
        .screen-out-box h2 {
            font-size: 28px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }
        
        .screen-out-box p {
            font-size: 16px;
            color: #64748b;
            line-height: 1.6;
            margin-bottom: 24px;
        }
        
        .info-link {
            display: inline-block;
            margin-top: 20px;
            padding: 14px 28px;
            background: linear-gradient(135deg, #1e3a8a 0%, #1d4ed8 100%);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }
        
        .info-link:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(30, 58, 138, 0.4);
        }
        
        @media (max-width: 640px) {
            body {
                font-size: 14px;
            }
            
            .survey-container {
                padding: 12px;
            }
            
            .page {
                padding: 24px 20px;
                margin-top: 60px;
                margin-bottom: 20px;
                border-radius: 12px;
            }
            
            h1 {
                font-size: 22px;
                margin-bottom: 12px;
                line-height: 1.3;
            }
            
            p {
                font-size: 14px;
                margin-bottom: 12px;
            }
            
            .intro-box {
                padding: 16px;
                margin: 16px 0;
            }
            
            .intro-box h3 {
                font-size: 15px;
                margin-bottom: 10px;
            }
            
            .intro-box li {
                padding: 4px 0;
                font-size: 13px;
            }
            
            .privacy-notice {
                padding: 14px;
                margin: 16px 0;
                font-size: 12px;
                line-height: 1.6;
            }
            
            .question-text {
                font-size: 20px;
                margin-bottom: 24px;
                padding-bottom: 16px;
            }
            
            .question-text::after {
                width: 50px;
                height: 3px;
            }
            
            .answer-option label {
                padding: 18px 56px 18px 20px;
                font-size: 16px;
            }
            
            .completion-stats {
                padding: 24px 0;
                margin-bottom: 32px;
            }
            
            .completion-stat {
                padding: 0 28px;
            }
            
            .completion-number {
                font-size: 32px;
            }
            
            .completion-label {
                font-size: 12px;
            }
            
            .thank-you-container {
                padding: 32px 16px;
            }
            
            .thank-you-title {
                font-size: 28px;
            }
            
            .thank-you-subtitle {
                font-size: 16px;
                margin-bottom: 32px;
            }
            
            .success-circle {
                width: 100px;
                height: 100px;
            }
            
            .success-animation {
                margin-bottom: 32px;
            }
            
            .privacy-reminder {
                padding: 20px;
                border-radius: 12px;
            }
            
            .screen-out-box {
                padding: 40px 16px;
            }
            
            .screen-out-box h2 {
                font-size: 24px;
            }
            
            .prop50-info-box,
            .prop50-argument-box {
                padding: 18px 20px;
                margin-bottom: 28px;
                border-radius: 12px;
            }
            
            .prop50-info-header,
            .prop50-argument-header {
                font-size: 12px;
                margin-bottom: 10px;
            }
            
            .prop50-info-content,
            .prop50-argument-content {
                font-size: 15px;
                line-height: 1.6;
            }
            
            .progress-text {
                font-size: 11px;
                padding: 6px 12px;
                top: 12px;
                right: 12px;
            }
            
            .answer-option label {
                padding: 15px 48px 15px 16px;
                font-size: 15px;
            }
            
            .answer-option input[type="radio"]:checked + label::after {
                right: 16px;
                font-size: 18px;
            }
            
            .button-primary {
                padding: 14px 24px;
                font-size: 15px;
                margin-top: 20px;
            }
            
            /* Welcome Page Mobile */
            .welcome-hero {
                padding: 0 0 24px 0;
                margin-bottom: 24px;
            }
            
            .welcome-badge {
                font-size: 10px;
                padding: 6px 16px;
                margin-bottom: 20px;
            }
            
            .welcome-title {
                font-size: 32px;
                margin-bottom: 12px;
            }
            
            .welcome-subtitle {
                font-size: 16px;
            }
            
            .welcome-stats {
                padding: 24px 0;
                margin-bottom: 24px;
            }
            
            .stat-item {
                padding: 0 20px;
            }
            
            .stat-number {
                font-size: 28px;
            }
            
            .stat-label {
                font-size: 12px;
            }
            
            .stat-divider {
                height: 40px;
            }
            
            .eligibility-card {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .eligibility-header {
                font-size: 15px;
                margin-bottom: 20px;
            }
            
            .eligibility-items {
                gap: 16px;
            }
            
            .eligibility-item {
                gap: 12px;
            }
            
            .eligibility-icon {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
            
            .eligibility-text strong {
                font-size: 14px;
            }
            
            .eligibility-text span {
                font-size: 13px;
            }
            
            .privacy-card {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .privacy-header {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .privacy-text {
                font-size: 13px;
            }
            
            .consent-box {
                padding: 20px;
                margin-bottom: 24px;
            }
            
            .consent-title {
                font-size: 14px;
                margin-bottom: 12px;
            }
            
            .consent-check {
                font-size: 13px;
            }
            
            .welcome-cta {
                font-size: 15px;
                padding: 16px 28px;
            }
        }
        
        @media (max-width: 640px) and (max-height: 750px) {
            .page {
                padding: 20px 16px;
                margin-top: 50px;
            }
            
            h1 {
                font-size: 20px;
                margin-bottom: 10px;
            }
            
            p {
                font-size: 13px;
                margin-bottom: 10px;
            }
            
            .intro-box {
                padding: 12px;
                margin: 12px 0;
            }
            
            .intro-box h3 {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .intro-box li {
                padding: 3px 0;
                font-size: 12px;
                line-height: 1.5;
            }
            
            .privacy-notice {
                padding: 12px;
                margin: 12px 0;
                font-size: 11px;
            }
            
            .button-primary {
                padding: 12px 20px;
                margin-top: 16px;
            }
            
            /* Welcome Page Mobile Short */
            .welcome-hero {
                padding: 0 0 20px 0;
                margin-bottom: 20px;
            }
            
            .welcome-badge {
                font-size: 9px;
                padding: 5px 14px;
                margin-bottom: 16px;
            }
            
            .welcome-title {
                font-size: 28px;
                margin-bottom: 10px;
            }
            
            .welcome-subtitle {
                font-size: 15px;
            }
            
            .welcome-stats {
                padding: 20px 0;
                margin-bottom: 20px;
            }
            
            .stat-item {
                padding: 0 16px;
            }
            
            .stat-number {
                font-size: 24px;
            }
            
            .stat-label {
                font-size: 11px;
            }
            
            .eligibility-card {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .eligibility-header {
                font-size: 14px;
                margin-bottom: 16px;
                gap: 10px;
            }
            
            .eligibility-header svg {
                width: 20px;
                height: 20px;
            }
            
            .eligibility-items {
                gap: 14px;
            }
            
            .eligibility-item {
                gap: 10px;
            }
            
            .eligibility-icon {
                width: 26px;
                height: 26px;
                font-size: 13px;
            }
            
            .eligibility-text strong {
                font-size: 13px;
            }
            
            .eligibility-text span {
                font-size: 12px;
            }
            
            .privacy-card {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .privacy-header {
                font-size: 13px;
                margin-bottom: 8px;
            }
            
            .privacy-header svg {
                width: 18px;
                height: 18px;
            }
            
            .privacy-text {
                font-size: 12px;
                line-height: 1.6;
            }
            
            .consent-box {
                padding: 16px;
                margin-bottom: 20px;
            }
            
            .consent-title {
                font-size: 13px;
                margin-bottom: 10px;
            }
            
            .consent-check {
                font-size: 12px;
            }
            
            .welcome-cta {
                font-size: 14px;
                padding: 14px 24px;
            }
            
            .welcome-cta svg {
                width: 18px;
                height: 18px;
            }
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Loading state */
        .answer-option.loading label {
            opacity: 0.6;
            cursor: wait;
        }
        
        /* Star Rating Styles */
        .rating-star:hover {
            transform: scale(1.2) !important;
            filter: drop-shadow(0 0 8px rgba(245, 158, 11, 0.6));
        }
        
        .rating-star.fas {
            animation: starPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes starPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.15); }
        }
        
        @keyframes slideDown {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 8px 32px rgba(59, 130, 246, 0.4);
            }
            50% {
                box-shadow: 0 8px 48px rgba(59, 130, 246, 0.6), 0 0 40px rgba(59, 130, 246, 0.3);
            }
        }
        
        @keyframes confettiDrop {
            to {
                transform: translateY(100vh);
            }
        }
        
        /* Enhanced answer option hover */
        .answer-option:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(30, 58, 138, 0.15);
        }
        
        /* Progress text enhancement */
        #progressText {
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        /* Answer selection feedback animations */
        @keyframes answerPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); box-shadow: 0 4px 20px rgba(30, 58, 138, 0.2); }
            100% { transform: scale(1); }
        }
        
        @keyframes checkmarkPop {
            0% { 
                transform: translateY(-50%) scale(0) rotate(-20deg); 
                opacity: 0; 
            }
            70% { 
                transform: translateY(-50%) scale(1.2) rotate(3deg); 
            }
            100% { 
                transform: translateY(-50%) scale(1) rotate(0deg); 
                opacity: 1; 
            }
        }
        
        .answer-checkmark {
            pointer-events: none;
        }
        
        /* Enhanced milestone toast mobile responsiveness */
        @media (max-width: 768px) {
            #milestone-toast {
                padding: 12px 24px;
                font-size: 14px;
                max-width: 90%;
            }
            
            /* Larger text for better mobile readability (especially for older users) */
            .question-text {
                font-size: 22px !important;
                line-height: 1.4;
            }
            
            .answer-option label {
                font-size: 17px !important;
                padding: 16px 50px 16px 18px !important;
                line-height: 1.5;
            }
        }
        
        @media (max-width: 480px) {
            /* Even larger for small phones */
            .question-text {
                font-size: 20px !important;
            }
            
            .answer-option label {
                font-size: 16px !important;
            }
            
            .prop50-info-box,
            .prop50-argument-box {
                padding: 16px 18px;
                margin-bottom: 24px;
            }
            
            .prop50-info-header,
            .prop50-argument-header {
                font-size: 11px;
            }
            
            .prop50-info-content,
            .prop50-argument-content {
                font-size: 14px;
            }
            
            /* Make "Just 3 min" badge more visible on mobile */
            .button-primary div[style*="Just 3 min"] {
                font-size: 14px !important;
                padding: 7px 16px !important;
            }
        }
    </style>
</head>
<body>
    <noscript>
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #f7f9fc; display: flex; align-items: center; justify-content: center; padding: 20px; z-index: 10000;">
            <div style="max-width: 500px; background: white; padding: 40px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center;">
                <div style="width: 80px; height: 80px; margin: 0 auto 24px; background: #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                </div>
                <h1 style="font-family: 'Inter', sans-serif; font-size: 24px; font-weight: 700; color: #0f172a; margin-bottom: 16px;">JavaScript Required</h1>
                <p style="font-family: 'Inter', sans-serif; font-size: 16px; color: #64748b; line-height: 1.6; margin: 0;">This survey requires JavaScript to be enabled in your browser. Please enable JavaScript and refresh the page to participate.</p>
            </div>
        </div>
    </noscript>
    <div class="progress-bar-container" style="opacity: 0; transition: opacity 0.3s;">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="progress-text" id="progressText" style="opacity: 0; transition: opacity 0.3s;"></div>
    
    <!-- Milestone celebration overlay - Subtle & Professional -->
    <div id="milestone-toast" style="position: fixed; top: 90px; left: 50%; transform: translateX(-50%) translateY(-20px); background: rgba(255, 255, 255, 0.98); color: #0f172a; padding: 12px 24px; border-radius: 12px; font-weight: 600; font-size: 14px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(59, 130, 246, 0.2); opacity: 0; pointer-events: none; z-index: 10001; transition: all 0.3s ease-out; display: flex; align-items: center; gap: 10px; backdrop-filter: blur(8px);">
        <i class="fas fa-check-circle" style="font-size: 16px; color: #3b82f6;"></i>
        <span id="milestone-text" style="color: #475569; font-size: 14px;"></span>
    </div>
    
    <style>
        .dev-tools {
            position: fixed;
            bottom: 12px;
            right: 12px;
            z-index: 10000;
        }
        
        .dev-button {
            width: 44px;
            height: 44px;
            background: rgba(148, 163, 184, 0.06);
            border: 1px solid rgba(148, 163, 184, 0.15);
            color: #94a3b8;
            padding: 0;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(12px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dev-button:hover {
            background: rgba(148, 163, 184, 0.12);
            border-color: rgba(148, 163, 184, 0.25);
            color: #64748b;
            transform: translateY(-2px) rotate(90deg);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .dev-button:active {
            transform: translateY(0) rotate(90deg);
        }
        
        /* Custom Checkbox Styling */
        .opt-in-checkbox {
            display: flex;
            align-items: start;
            gap: 12px;
            cursor: pointer;
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 8px;
            transition: background 0.2s;
            position: relative;
        }
        
        .opt-in-checkbox:hover {
            background: rgba(37, 99, 235, 0.04);
        }
        
        .opt-in-checkbox input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }
        
        .opt-in-checkbox .checkmark {
            position: relative;
            height: 20px;
            width: 20px;
            background-color: white;
            border: 2px solid #cbd5e1;
            border-radius: 5px;
            transition: all 0.2s;
            flex-shrink: 0;
            margin-top: 1px;
        }
        
        .opt-in-checkbox:hover .checkmark {
            border-color: #1e3a8a;
        }
        
        .opt-in-checkbox input:checked ~ .checkmark {
            background-color: #1e3a8a;
            border-color: #1e3a8a;
        }
        
        .opt-in-checkbox .checkmark:after {
            content: "";
            position: absolute;
            display: none;
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        .opt-in-checkbox input:checked ~ .checkmark:after {
            display: block;
        }
        
        .opt-in-checkbox .opt-in-text {
            font-size: 14px;
            color: #475569;
            line-height: 1.5;
        }
        
        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 540px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes slideUp {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @media (max-width: 640px) {
            .dev-button {
                width: 48px;
                height: 48px;
                font-size: 18px;
            }
            
            .modal-content {
                padding: 28px 24px;
                width: 95%;
            }
        }
    </style>
    
    <!-- How It Works Modal -->
    <div id="instructions-modal" class="modal-overlay">
        <div class="modal-content">
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: linear-gradient(135deg, #1e3a8a 0%, #1d4ed8 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);">
                    <i class="fas fa-info-circle" style="font-size: 32px; color: white;"></i>
                </div>
                <h2 style="margin: 0 0 8px 0; font-size: 24px; color: #0f172a; font-weight: 700;">How This Works</h2>
                <p style="margin: 0; color: #64748b; font-size: 15px;">Quick instructions before you start</p>
            </div>
            
            <div style="background: #f8fafc; border-radius: 12px; padding: 20px; margin-bottom: 24px; border-left: 4px solid #1e3a8a;">
                <div style="display: flex; align-items: start; gap: 16px; margin-bottom: 16px;">
                    <div style="flex-shrink: 0; width: 40px; height: 40px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">
                        <i class="fas fa-hand-pointer" style="font-size: 20px; color: #1e3a8a;"></i>
                    </div>
                    <div>
                        <h3 style="margin: 0 0 6px 0; font-size: 16px; color: #0f172a; font-weight: 700;">Tap to Advance</h3>
                        <p style="margin: 0; color: #475569; font-size: 15px; line-height: 1.6;">Simply select your answer and the survey automatically moves forward. No "Next" buttons needed!</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: start; gap: 16px;">
                    <div style="flex-shrink: 0; width: 40px; height: 40px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">
                        <i class="fas fa-clock" style="font-size: 20px; color: #1e3a8a;"></i>
                    </div>
                    <div>
                        <h3 style="margin: 0 0 6px 0; font-size: 16px; color: #0f172a; font-weight: 700;">Takes 2–5 Minutes</h3>
                        <p style="margin: 0; color: #475569; font-size: 15px; line-height: 1.6;">Your honest opinions help shape civic research. Every response matters!</p>
                    </div>
                </div>
            </div>
            
            <button onclick="survey.closeInstructions()" style="width: 100%; padding: 16px; font-size: 17px; font-weight: 700; background: linear-gradient(135deg, #1e3a8a 0%, #1d4ed8 100%); color: white; border: none; border-radius: 12px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 16px rgba(37, 99, 235, 0.4);">
                Got It! Let's Start <i class="fas fa-arrow-right" style="margin-left: 8px;"></i>
            </button>
        </div>
    </div>
    
    <!-- Reset Confirmation Modal -->
    <div id="reset-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 420px;">
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);">
                    <i class="fas fa-exclamation-triangle" style="font-size: 32px; color: white;"></i>
                </div>
                <h2 style="margin: 0 0 8px 0; font-size: 22px; color: #0f172a; font-weight: 700;">Clear All Data?</h2>
                <p style="margin: 0; color: #64748b; font-size: 15px; line-height: 1.6;">This will delete all saved responses and restart the survey from the beginning.</p>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button onclick="devTools.cancelReset()" style="flex: 1; padding: 14px; font-size: 16px; font-weight: 600; background: white; color: #475569; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.2s;">
                    Cancel
                </button>
                <button onclick="devTools.confirmReset()" style="flex: 1; padding: 14px; font-size: 16px; font-weight: 700; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 10px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);">
                    <i class="fas fa-trash-alt" style="margin-right: 6px;"></i> Clear Data
                </button>
            </div>
        </div>
    </div>
    
    <div class="dev-tools">
        <button class="dev-button" onclick="devTools.reset()" title="Clear all data and restart survey">
            <i class="fas fa-rotate-right"></i>
        </button>
    </div>
    
    <div class="survey-container" id="surveyContainer">
        <!-- Welcome Page -->
        <div class="page" id="page-welcome">
            <div class="welcome-hero">
                <div class="welcome-badge">CONFIDENTIAL RESEARCH</div>
                <h1 class="welcome-title">California Voter<br>Opinion Survey</h1>
                <p class="welcome-subtitle">Your voice shapes the future of California</p>
            </div>
            
            <div class="welcome-stats">
                <div class="stat-item">
                    <div class="stat-number">2–5</div>
                    <div class="stat-label">Minutes</div>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item">
                    <div class="stat-number">20</div>
                    <div class="stat-label">Questions</div>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">Confidential</div>
                </div>
            </div>
            
            <div class="eligibility-card">
                <div class="eligibility-header">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <span>Eligibility Requirements</span>
                </div>
                <div class="eligibility-items">
                    <div class="eligibility-item">
                        <div class="eligibility-icon">✓</div>
                        <div class="eligibility-text">
                            <strong>Age 18 or older</strong>
                            <span>Must be of legal voting age</span>
                        </div>
                    </div>
                    <div class="eligibility-item">
                        <div class="eligibility-icon">✓</div>
                        <div class="eligibility-text">
                            <strong>California Resident</strong>
                            <span>Currently reside in California</span>
                        </div>
                    </div>
                    <div class="eligibility-item">
                        <div class="eligibility-icon">✓</div>
                        <div class="eligibility-text">
                            <strong>Registered Voter</strong>
                            <span>Active California voter registration</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="privacy-card">
                <div class="privacy-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    <span>Your Privacy is Protected</span>
                </div>
                <p class="privacy-text">Your responses are confidential and will not be publicly disclosed. We collect IP addresses solely for validation and quality control. All results are reported in aggregate form only. Your data will not be sold or used for commercial purposes.</p>
            </div>
            
            <div class="consent-box">
                <p class="consent-title">By continuing, you confirm:</p>
                <div class="consent-items">
                    <div class="consent-check">✓ I meet all eligibility requirements above</div>
                    <div class="consent-check">✓ I voluntarily consent to participate</div>
                    <div class="consent-check">✓ I understand my responses are confidential and may be used for research purposes</div>
                </div>
            </div>
            
            <button class="button-primary welcome-cta" onclick="survey.giveConsent()" style="position: relative; overflow: visible;">
                <span>Start Now — Make Your Voice Count</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
                <div style="position: absolute; top: -10px; right: -10px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; font-size: 13px; font-weight: 800; padding: 6px 14px; border-radius: 14px; box-shadow: 0 3px 12px rgba(245, 158, 11, 0.5); animation: pulse 2s ease-in-out infinite;">
                    Just 3 min
                </div>
            </button>
        </div>

        <!-- Consent Page -->
        <div class="page hidden" id="page-consent">
            <span class="question-number">Eligibility Confirmation</span>
            <div class="question-text">Do you confirm that you are 18 years of age or older, a registered voter in California, and voluntarily consent to participate in this confidential research survey?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="consent" id="consent-yes" value="Yes" onchange="survey.answerQuestion('consent', 'Yes')">
                    <label for="consent-yes">Yes, I confirm</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="consent" id="consent-no" value="No" onchange="survey.answerQuestion('consent', 'No')">
                    <label for="consent-no">No</label>
                </div>
            </div>
        </div>

        <!-- Political Interest -->
        <div class="page hidden" id="page-q2">
            <div class="question-text">How much interest do you have in politics?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q2" id="q2-1" value="A great deal" onchange="survey.answerQuestion('q2', 'A great deal')">
                    <label for="q2-1">A great deal</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q2" id="q2-2" value="A fair amount" onchange="survey.answerQuestion('q2', 'A fair amount')">
                    <label for="q2-2">A fair amount</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q2" id="q2-3" value="Only a little" onchange="survey.answerQuestion('q2', 'Only a little')">
                    <label for="q2-3">Only a little</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q2" id="q2-4" value="None at all" onchange="survey.answerQuestion('q2', 'None at all')">
                    <label for="q2-4">None at all</label>
                </div>
            </div>
        </div>

        <!-- Country Direction -->
        <div class="page hidden" id="page-q3">
            <div class="question-text">Overall, would you say things in <strong style="color: #1e3a8a;">this country</strong> today are…</div>
            
            <div class="answer-options" id="q3-options">
                <div class="answer-option" data-order="1">
                    <input type="radio" name="q3" id="q3-1" value="Generally headed in the right direction" onchange="survey.answerQuestion('q3', 'Generally headed in the right direction')">
                    <label for="q3-1">Generally headed in the right direction</label>
                </div>
                <div class="answer-option" data-order="2">
                    <input type="radio" name="q3" id="q3-2" value="Off on the wrong track" onchange="survey.answerQuestion('q3', 'Off on the wrong track')">
                    <label for="q3-2">Off on the wrong track</label>
                </div>
            </div>
        </div>

        <!-- California Direction -->
        <div class="page hidden" id="page-q4">
            <div class="question-text">Would you say things in <strong style="color: #1e3a8a;">California</strong> are…</div>
            
            <div class="answer-options" id="q4-options">
                <div class="answer-option" data-order="1">
                    <input type="radio" name="q4" id="q4-1" value="Generally headed in the right direction" onchange="survey.answerQuestion('q4', 'Generally headed in the right direction')">
                    <label for="q4-1">Generally headed in the right direction</label>
                </div>
                <div class="answer-option" data-order="2">
                    <input type="radio" name="q4" id="q4-2" value="Off on the wrong track" onchange="survey.answerQuestion('q4', 'Off on the wrong track')">
                    <label for="q4-2">Off on the wrong track</label>
                </div>
            </div>
        </div>

        <!-- Trump Approval -->
        <div class="page hidden" id="page-q5">
            <div class="question-text">Do you approve of the job <strong style="color: #1e3a8a;">Donald Trump</strong> is doing as <strong style="color: #1e3a8a;">President?</strong></div>
            
            <div class="answer-options" id="q5-options">
                <div class="answer-option" data-order="1">
                    <input type="radio" name="q5" id="q5-1" value="Strongly approve" onchange="survey.answerQuestion('q5', 'Strongly approve')">
                    <label for="q5-1">Strongly approve</label>
                </div>
                <div class="answer-option" data-order="2">
                    <input type="radio" name="q5" id="q5-2" value="Somewhat approve" onchange="survey.answerQuestion('q5', 'Somewhat approve')">
                    <label for="q5-2">Somewhat approve</label>
                </div>
                <div class="answer-option" data-order="3">
                    <input type="radio" name="q5" id="q5-3" value="Somewhat disapprove" onchange="survey.answerQuestion('q5', 'Somewhat disapprove')">
                    <label for="q5-3">Somewhat disapprove</label>
                </div>
                <div class="answer-option" data-order="4">
                    <input type="radio" name="q5" id="q5-4" value="Strongly disapprove" onchange="survey.answerQuestion('q5', 'Strongly disapprove')">
                    <label for="q5-4">Strongly disapprove</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q5" id="q5-5" value="Don't know" onchange="survey.answerQuestion('q5', 'Don\'t know')">
                    <label for="q5-5">Don't know</label>
                </div>
            </div>
        </div>

        <!-- Newsom Approval -->
        <div class="page hidden" id="page-q6">
            <div class="question-text">Do you approve of the job <strong style="color: #1e3a8a;">Gavin Newsom</strong> is doing as <strong style="color: #1e3a8a;">Governor?</strong></div>
            
            <div class="answer-options" id="q6-options">
                <div class="answer-option" data-order="1">
                    <input type="radio" name="q6" id="q6-1" value="Strongly approve" onchange="survey.answerQuestion('q6', 'Strongly approve')">
                    <label for="q6-1">Strongly approve</label>
                </div>
                <div class="answer-option" data-order="2">
                    <input type="radio" name="q6" id="q6-2" value="Somewhat approve" onchange="survey.answerQuestion('q6', 'Somewhat approve')">
                    <label for="q6-2">Somewhat approve</label>
                </div>
                <div class="answer-option" data-order="3">
                    <input type="radio" name="q6" id="q6-3" value="Somewhat disapprove" onchange="survey.answerQuestion('q6', 'Somewhat disapprove')">
                    <label for="q6-3">Somewhat disapprove</label>
                </div>
                <div class="answer-option" data-order="4">
                    <input type="radio" name="q6" id="q6-4" value="Strongly disapprove" onchange="survey.answerQuestion('q6', 'Strongly disapprove')">
                    <label for="q6-4">Strongly disapprove</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q6" id="q6-5" value="Don't know" onchange="survey.answerQuestion('q6', 'Don\'t know')">
                    <label for="q6-5">Don't know</label>
                </div>
            </div>
        </div>

        <!-- Newsom Presidential Viability -->
        <div class="page hidden" id="page-q7">
            <div class="question-text">How do you feel about <strong style="color: #1e3a8a;">Newsom</strong> running for president in <strong style="color: #1e3a8a;">2028?</strong></div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q7" id="q7-1" value="Strong president - CA success shows national readiness" onchange="survey.answerQuestion('q7', 'Strong president - CA success shows national readiness')">
                    <label for="q7-1">He'd be a strong president — his California success shows he's ready</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q7" id="q7-2" value="Qualified but prefer other Democrats" onchange="survey.answerQuestion('q7', 'Qualified but prefer other Democrats')">
                    <label for="q7-2">He's qualified, but I'd prefer other Democrats</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q7" id="q7-3" value="CA problems make him unqualified" onchange="survey.answerQuestion('q7', 'CA problems make him unqualified')">
                    <label for="q7-3">California's problems show he's not ready</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q7" id="q7-4" value="Would never support under any circumstances" onchange="survey.answerQuestion('q7', 'Would never support under any circumstances')">
                    <label for="q7-4">I would never support him</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q7" id="q7-5" value="Not sure" onchange="survey.answerQuestion('q7', 'Not sure')">
                    <label for="q7-5">Not sure</label>
                </div>
            </div>
        </div>

        <!-- Newsom National Leadership Assessment -->
        <div class="page hidden" id="page-q7a">
            <div class="question-text">Thinking about Newsom as a potential <strong style="color: #1e3a8a;">national leader,</strong> which comes closest to your view?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q7a" id="q7a-1" value="Ready now - proven executive" onchange="survey.answerQuestion('q7a', 'Ready now - proven executive')">
                    <label for="q7a-1">Ready now — he's a proven executive with big-state experience</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q7a" id="q7a-2" value="Good governor, wrong for president" onchange="survey.answerQuestion('q7a', 'Good governor, wrong for president')">
                    <label for="q7a-2">He's been a good governor, but wrong for president</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q7a" id="q7a-3" value="Fix California first" onchange="survey.answerQuestion('q7a', 'Fix California first')">
                    <label for="q7a-3">Needs to fix California's problems before seeking national office</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q7a" id="q7a-4" value="Good communicator, poor results" onchange="survey.answerQuestion('q7a', 'Good communicator, poor results')">
                    <label for="q7a-4">Good communicator but results don't match the rhetoric</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q7a" id="q7a-5" value="Would oppose regardless" onchange="survey.answerQuestion('q7a', 'Would oppose regardless')">
                    <label for="q7a-5">Would oppose him regardless of accomplishments</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q7a" id="q7a-6" value="Too early to say" onchange="survey.answerQuestion('q7a', 'Too early to say')">
                    <label for="q7a-6">Too early to say</label>
                </div>
            </div>
        </div>

        <!-- Party ID -->
        <div class="page hidden" id="page-q8">
            <div class="question-text">Do you consider yourself a…</div>
            
            <div class="answer-options" id="q8-options">
                <div class="answer-option" data-order="1">
                    <input type="radio" name="q8" id="q8-1" value="Republican" onchange="survey.answerQuestion('q8', 'Republican')">
                    <label for="q8-1">Republican</label>
                </div>
                <div class="answer-option" data-order="2">
                    <input type="radio" name="q8" id="q8-2" value="Democrat" onchange="survey.answerQuestion('q8', 'Democrat')">
                    <label for="q8-2">Democrat</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q8" id="q8-3" value="Independent" onchange="survey.answerQuestion('q8', 'Independent')">
                    <label for="q8-3">Independent</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q8" id="q8-4" value="No party preference" onchange="survey.answerQuestion('q8', 'No party preference')">
                    <label for="q8-4">No party preference</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q8" id="q8-5" value="Other party" onchange="survey.answerQuestion('q8', 'Other party')">
                    <label for="q8-5">Other party</label>
                </div>
            </div>
        </div>

        <!-- Ideology -->
        <div class="page hidden" id="page-q9">
            <div class="question-text">In general, how would you describe your own political viewpoint?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q9" id="q9-1" value="Very conservative" onchange="survey.answerQuestion('q9', 'Very conservative')">
                    <label for="q9-1">Very conservative</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q9" id="q9-2" value="Conservative" onchange="survey.answerQuestion('q9', 'Conservative')">
                    <label for="q9-2">Conservative</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q9" id="q9-3" value="Moderate" onchange="survey.answerQuestion('q9', 'Moderate')">
                    <label for="q9-3">Moderate</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q9" id="q9-4" value="Liberal" onchange="survey.answerQuestion('q9', 'Liberal')">
                    <label for="q9-4">Liberal</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q9" id="q9-5" value="Very liberal" onchange="survey.answerQuestion('q9', 'Very liberal')">
                    <label for="q9-5">Very liberal</label>
                </div>
            </div>
        </div>

        <!-- California's Biggest Problem -->
        <div class="page hidden" id="page-q10">
            <div class="question-text">In your opinion, what is California's <strong style="color: #1e3a8a;">BIGGEST problem</strong> right now?</div>
            
            <div class="answer-options" id="q10-options">
                <div class="answer-option" data-issue-order="1">
                    <input type="radio" name="q10" id="q10-1" value="Homelessness" onchange="survey.answerQuestion('q10', 'Homelessness')">
                    <label for="q10-1">Homelessness</label>
                </div>
                <div class="answer-option" data-issue-order="2">
                    <input type="radio" name="q10" id="q10-2" value="Cost of living and housing affordability" onchange="survey.answerQuestion('q10', 'Cost of living and housing affordability')">
                    <label for="q10-2">Cost of living and housing affordability</label>
                </div>
                <div class="answer-option" data-issue-order="3">
                    <input type="radio" name="q10" id="q10-3" value="Crime and public safety" onchange="survey.answerQuestion('q10', 'Crime and public safety')">
                    <label for="q10-3">Crime and public safety</label>
                </div>
                <div class="answer-option" data-issue-order="4">
                    <input type="radio" name="q10" id="q10-4" value="Taxes and government spending" onchange="survey.answerQuestion('q10', 'Taxes and government spending')">
                    <label for="q10-4">Taxes and government spending</label>
                </div>
                <div class="answer-option" data-issue-order="5">
                    <input type="radio" name="q10" id="q10-5" value="Illegal immigration and border security" onchange="survey.answerQuestion('q10', 'Illegal immigration and border security')">
                    <label for="q10-5">Illegal immigration and border security</label>
                </div>
                <div class="answer-option" data-issue-order="6">
                    <input type="radio" name="q10" id="q10-6" value="Federal immigration raids and deportations" onchange="survey.answerQuestion('q10', 'Federal immigration raids and deportations')">
                    <label for="q10-6">Federal immigration raids and deportations</label>
                </div>
                <div class="answer-option" data-issue-order="7">
                    <input type="radio" name="q10" id="q10-7" value="Education and schools" onchange="survey.answerQuestion('q10', 'Education and schools')">
                    <label for="q10-7">Education and schools</label>
                </div>
                <div class="answer-option" data-issue-order="8">
                    <input type="radio" name="q10" id="q10-8" value="Wildfires and climate change" onchange="survey.answerQuestion('q10', 'Wildfires and climate change')">
                    <label for="q10-8">Wildfires and climate change</label>
                </div>
            </div>
        </div>
        
        <!-- Newsom's Worst Performance -->
        <div class="page hidden" id="page-q11">
            <div class="question-text">On which issue has <strong style="color: #1e3a8a;">Governor Newsom</strong> done the <strong style="color: #1e3a8a;">WORST</strong> job?</div>
            
            <div class="answer-options" id="q11-options">
                <div class="answer-option" data-issue-order="1">
                    <input type="radio" name="q11" id="q11-1" value="Homelessness" onchange="survey.answerQuestion('q11', 'Homelessness')">
                    <label for="q11-1">Homelessness</label>
                </div>
                <div class="answer-option" data-issue-order="2">
                    <input type="radio" name="q11" id="q11-2" value="Cost of living and housing affordability" onchange="survey.answerQuestion('q11', 'Cost of living and housing affordability')">
                    <label for="q11-2">Cost of living and housing affordability</label>
                </div>
                <div class="answer-option" data-issue-order="3">
                    <input type="radio" name="q11" id="q11-3" value="Crime and public safety" onchange="survey.answerQuestion('q11', 'Crime and public safety')">
                    <label for="q11-3">Crime and public safety</label>
                </div>
                <div class="answer-option" data-issue-order="4">
                    <input type="radio" name="q11" id="q11-4" value="Taxes and government spending" onchange="survey.answerQuestion('q11', 'Taxes and government spending')">
                    <label for="q11-4">Taxes and government spending</label>
                </div>
                <div class="answer-option" data-issue-order="5">
                    <input type="radio" name="q11" id="q11-5" value="Illegal immigration and border security" onchange="survey.answerQuestion('q11', 'Illegal immigration and border security')">
                    <label for="q11-5">Illegal immigration and border security</label>
                </div>
                <div class="answer-option" data-issue-order="6">
                    <input type="radio" name="q11" id="q11-6" value="Federal immigration raids and deportations" onchange="survey.answerQuestion('q11', 'Federal immigration raids and deportations')">
                    <label for="q11-6">Federal immigration raids and deportations</label>
                </div>
                <div class="answer-option" data-issue-order="7">
                    <input type="radio" name="q11" id="q11-7" value="Education and schools" onchange="survey.answerQuestion('q11', 'Education and schools')">
                    <label for="q11-7">Education and schools</label>
                </div>
                <div class="answer-option" data-issue-order="8">
                    <input type="radio" name="q11" id="q11-8" value="Wildfires and climate change" onchange="survey.answerQuestion('q11', 'Wildfires and climate change')">
                    <label for="q11-8">Wildfires and climate change</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q11" id="q11-9" value="None - all handled well" onchange="survey.answerQuestion('q11', 'None - all handled well')">
                    <label for="q11-9">None - all handled well</label>
                </div>
            </div>
        </div>
        
        <!-- Newsom's Best Performance -->
        <div class="page hidden" id="page-q12">
            <div class="question-text">On which issue has <strong style="color: #1e3a8a;">Governor Newsom</strong> done the <strong style="color: #1e3a8a;">BEST</strong> job?</div>
            
            <div class="answer-options" id="q12-options">
                <div class="answer-option" data-issue-order="1">
                    <input type="radio" name="q12" id="q12-1" value="Homelessness" onchange="survey.answerQuestion('q12', 'Homelessness')">
                    <label for="q12-1">Homelessness</label>
                </div>
                <div class="answer-option" data-issue-order="2">
                    <input type="radio" name="q12" id="q12-2" value="Cost of living and housing affordability" onchange="survey.answerQuestion('q12', 'Cost of living and housing affordability')">
                    <label for="q12-2">Cost of living and housing affordability</label>
                </div>
                <div class="answer-option" data-issue-order="3">
                    <input type="radio" name="q12" id="q12-3" value="Crime and public safety" onchange="survey.answerQuestion('q12', 'Crime and public safety')">
                    <label for="q12-3">Crime and public safety</label>
                </div>
                <div class="answer-option" data-issue-order="4">
                    <input type="radio" name="q12" id="q12-4" value="Taxes and government spending" onchange="survey.answerQuestion('q12', 'Taxes and government spending')">
                    <label for="q12-4">Taxes and government spending</label>
                </div>
                <div class="answer-option" data-issue-order="5">
                    <input type="radio" name="q12" id="q12-5" value="Illegal immigration and border security" onchange="survey.answerQuestion('q12', 'Illegal immigration and border security')">
                    <label for="q12-5">Illegal immigration and border security</label>
                </div>
                <div class="answer-option" data-issue-order="6">
                    <input type="radio" name="q12" id="q12-6" value="Federal immigration raids and deportations" onchange="survey.answerQuestion('q12', 'Federal immigration raids and deportations')">
                    <label for="q12-6">Federal immigration raids and deportations</label>
                </div>
                <div class="answer-option" data-issue-order="7">
                    <input type="radio" name="q12" id="q12-7" value="Education and schools" onchange="survey.answerQuestion('q12', 'Education and schools')">
                    <label for="q12-7">Education and schools</label>
                </div>
                <div class="answer-option" data-issue-order="8">
                    <input type="radio" name="q12" id="q12-8" value="Wildfires and climate change" onchange="survey.answerQuestion('q12', 'Wildfires and climate change')">
                    <label for="q12-8">Wildfires and climate change</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q12" id="q12-9" value="None - all handled poorly" onchange="survey.answerQuestion('q12', 'None - all handled poorly')">
                    <label for="q12-9">None - all handled poorly</label>
                </div>
            </div>
        </div>
        
        <!-- Balanced Assessment -->
        <div class="page hidden" id="page-q13">
            <div class="question-text">After considering everything, which statement comes <strong style="color: #1e3a8a;">closest</strong> to your overall view of Governor Newsom?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q13" id="q13-1" value="Handling California well given challenges" onchange="survey.answerQuestion('q13', 'Handling California well given challenges')">
                    <label for="q13-1">He's handled California well given the challenges</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q13" id="q13-2" value="Good communicator, results don't match" onchange="survey.answerQuestion('q13', 'Good communicator, results don\'t match')">
                    <label for="q13-2">Good communicator, but results don't match the rhetoric</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q13" id="q13-3" value="Problems show national unreadiness" onchange="survey.answerQuestion('q13', 'Problems show national unreadiness')">
                    <label for="q13-3">California's problems show he's not ready for national office</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q13" id="q13-4" value="Mixed - good and bad" onchange="survey.answerQuestion('q13', 'Mixed - good and bad')">
                    <label for="q13-4">Done well on some things, poorly on others</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q13" id="q13-5" value="Not sure" onchange="survey.answerQuestion('q13', 'Not sure')">
                    <label for="q13-5">Not sure</label>
                </div>
            </div>
        </div>

        <!-- Congressional Vote -->
        <div class="page hidden" id="page-q14">
            <div class="question-text">In the <strong style="color: #1e3a8a;">2026</strong> election for <strong style="color: #1e3a8a;">U.S. Congress,</strong> who would you vote for in your district?</div>
            
            <div class="answer-options" id="q14-options">
                <div class="answer-option" data-order="1">
                    <input type="radio" name="q14" id="q14-1" value="Democrat" onchange="survey.answerQuestion('q14', 'Democrat')">
                    <label for="q14-1">Democrat</label>
                </div>
                <div class="answer-option" data-order="2">
                    <input type="radio" name="q14" id="q14-2" value="Republican" onchange="survey.answerQuestion('q14', 'Republican')">
                    <label for="q14-2">Republican</label>
                </div>
                <div class="answer-option" data-order="3">
                    <input type="radio" name="q14" id="q14-3" value="Other" onchange="survey.answerQuestion('q14', 'Other')">
                    <label for="q14-3">Other</label>
                </div>
                <div class="answer-option" data-order="4">
                    <input type="radio" name="q14" id="q14-4" value="Undecided" onchange="survey.answerQuestion('q14', 'Undecided')">
                    <label for="q14-4">Undecided</label>
                </div>
            </div>
        </div>

        <!-- Primary News Source -->
        <div class="page hidden" id="page-q15">
            <div class="question-text">What is your <strong style="color: #1e3a8a;">primary source</strong> for political news and information?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-1" value="Television news" onchange="survey.answerQuestion('q15', 'Television news')">
                    <label for="q15-1">Television news</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-2" value="Facebook" onchange="survey.answerQuestion('q15', 'Facebook')">
                    <label for="q15-2">Facebook</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-3" value="YouTube" onchange="survey.answerQuestion('q15', 'YouTube')">
                    <label for="q15-3">YouTube</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-4" value="TikTok" onchange="survey.answerQuestion('q15', 'TikTok')">
                    <label for="q15-4">TikTok</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-5" value="X/Twitter" onchange="survey.answerQuestion('q15', 'X/Twitter')">
                    <label for="q15-5">X / Twitter</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-6" value="Instagram" onchange="survey.answerQuestion('q15', 'Instagram')">
                    <label for="q15-6">Instagram</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-7" value="Online news websites" onchange="survey.answerQuestion('q15', 'Online news websites')">
                    <label for="q15-7">Online news websites</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-8" value="Newspapers" onchange="survey.answerQuestion('q15', 'Newspapers (print or digital)')">
                    <label for="q15-8">Newspapers (print or digital)</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-9" value="Radio" onchange="survey.answerQuestion('q15', 'Radio')">
                    <label for="q15-9">Radio</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-10" value="Podcasts" onchange="survey.answerQuestion('q15', 'Podcasts')">
                    <label for="q15-10">Podcasts</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q15" id="q15-11" value="I don't pay attention to the news" onchange="survey.answerQuestion('q15', 'I don\'t pay attention to the news')">
                    <label for="q15-11">I don't pay attention to the news</label>
                </div>
            </div>
        </div>

        <!-- Education -->
        <div class="page hidden" id="page-q16">
            <div class="question-text">What is the highest level of education you have completed?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q16" id="q16-1" value="Less than high school" onchange="survey.answerQuestion('q16', 'Less than high school')">
                    <label for="q16-1">Less than high school</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q16" id="q16-2" value="High school diploma or GED" onchange="survey.answerQuestion('q16', 'High school diploma or GED')">
                    <label for="q16-2">High school diploma or GED</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q16" id="q16-3" value="Technical or vocational training" onchange="survey.answerQuestion('q16', 'Technical or vocational training')">
                    <label for="q16-3">Technical or vocational training</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q16" id="q16-4" value="Some college (no degree)" onchange="survey.answerQuestion('q16', 'Some college (no degree)')">
                    <label for="q16-4">Some college (no degree)</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q16" id="q16-5" value="Associate degree" onchange="survey.answerQuestion('q16', 'Associate degree')">
                    <label for="q16-5">Associate degree</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q16" id="q16-6" value="Bachelor's degree" onchange="survey.answerQuestion('q16', 'Bachelor\'s degree')">
                    <label for="q16-6">Bachelor's degree</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q16" id="q16-7" value="Graduate or professional degree" onchange="survey.answerQuestion('q16', 'Graduate or professional degree')">
                    <label for="q16-7">Graduate or professional degree</label>
                </div>
            </div>
        </div>

        <!-- Race/Ethnicity -->
        <div class="page hidden" id="page-q17">
            <div class="question-text">What best describes your race or ethnicity?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q17" id="q17-1" value="White or Caucasian" onchange="survey.answerQuestion('q17', 'White or Caucasian')">
                    <label for="q17-1">White or Caucasian</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q17" id="q17-2" value="Hispanic or Latino" onchange="survey.answerQuestion('q17', 'Hispanic or Latino')">
                    <label for="q17-2">Hispanic or Latino</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q17" id="q17-3" value="Black or African American" onchange="survey.answerQuestion('q17', 'Black or African American')">
                    <label for="q17-3">Black or African American</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q17" id="q17-4" value="Asian or Pacific Islander" onchange="survey.answerQuestion('q17', 'Asian or Pacific Islander')">
                    <label for="q17-4">Asian or Pacific Islander</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q17" id="q17-5" value="Native American or Alaska Native" onchange="survey.answerQuestion('q17', 'Native American or Alaska Native')">
                    <label for="q17-5">Native American or Alaska Native</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q17" id="q17-6" value="Two or more races" onchange="survey.answerQuestion('q17', 'Two or more races')">
                    <label for="q17-6">Two or more races</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q17" id="q17-7" value="Other" onchange="survey.answerQuestion('q17', 'Other')">
                    <label for="q17-7">Other</label>
                </div>
            </div>
        </div>

        <!-- Income -->
        <div class="page hidden" id="page-q18">
            <div class="question-text">What is your household's annual income before taxes?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q18" id="q18-1" value="Under $50,000" onchange="survey.answerQuestion('q18', 'Under $50,000')">
                    <label for="q18-1">Under $50,000</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q18" id="q18-2" value="$50,000 to $99,999" onchange="survey.answerQuestion('q18', '$50,000 to $99,999')">
                    <label for="q18-2">$50,000 to $99,999</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q18" id="q18-3" value="$100,000 to $149,999" onchange="survey.answerQuestion('q18', '$100,000 to $149,999')">
                    <label for="q18-3">$100,000 to $149,999</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q18" id="q18-4" value="$150,000 to $199,999" onchange="survey.answerQuestion('q18', '$150,000 to $199,999')">
                    <label for="q18-4">$150,000 to $199,999</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q18" id="q18-5" value="$200,000 or more" onchange="survey.answerQuestion('q18', '$200,000 or more')">
                    <label for="q18-5">$200,000 or more</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q18" id="q18-6" value="Prefer not to say" onchange="survey.answerQuestion('q18', 'Prefer not to say')">
                    <label for="q18-6">Prefer not to say</label>
                </div>
            </div>
        </div>

        <!-- Gender -->
        <div class="page hidden" id="page-q19">
            <div class="question-text">What is your gender?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="q19" id="q19-1" value="Male" onchange="survey.answerQuestion('q19', 'Male')">
                    <label for="q19-1">Male</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q19" id="q19-2" value="Female" onchange="survey.answerQuestion('q19', 'Female')">
                    <label for="q19-2">Female</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q19" id="q19-3" value="Other" onchange="survey.answerQuestion('q19', 'Other')">
                    <label for="q19-3">Other</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="q19" id="q19-4" value="Prefer not to say" onchange="survey.answerQuestion('q19', 'Prefer not to say')">
                    <label for="q19-4">Prefer not to say</label>
                </div>
            </div>
        </div>

        <!-- Thank You Page -->
        <div class="page hidden" id="page-thankyou">
            <div class="thank-you-container">
                <!-- Confetti Container -->
                <div id="main-confetti-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></div>
                
                <div class="success-animation">
                    <div class="success-circle">
                        <div class="success-checkmark">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                                <circle cx="40" cy="40" r="38" stroke="#3b82f6" stroke-width="4" class="success-circle-path"/>
                                <path d="M20 40 L35 55 L60 25" stroke="#3b82f6" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" class="success-check-path"/>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <h1 class="thank-you-title" style="animation: fadeIn 0.6s ease-out 0.1s both;">🎉 Survey Complete!</h1>
                <p class="thank-you-subtitle" style="animation: fadeIn 0.6s ease-out 0.2s both; font-size: 20px; color: #1e3a8a;">Your voice matters. Thank you for making a difference.</p>
                
                <div style="display: flex; justify-content: center; gap: 32px; margin: 24px 0 32px 0; padding: 20px 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; border: 2px solid #1e3a8a; box-shadow: 0 4px 20px rgba(37, 99, 235, 0.08); animation: bounceIn 0.6s ease-out 0.3s both;">
                    <div style="text-align: center;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 4px;">
                            <i class="fas fa-check-circle" style="font-size: 16px; color: #3b82f6;"></i>
                            <div style="font-size: 24px; font-weight: 700; color: #1e3a8a;">20</div>
                        </div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 2px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Questions</div>
                    </div>
                    <div style="width: 2px; background: linear-gradient(to bottom, transparent, #cbd5e1 20%, #cbd5e1 80%, transparent);"></div>
                    <div style="text-align: center;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 4px;">
                            <i class="fas fa-clock" style="font-size: 16px; color: #3b82f6;"></i>
                            <div id="completion-time" style="font-size: 24px; font-weight: 700; color: #1e3a8a;">—</div>
                        </div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 2px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Minutes</div>
                    </div>
                </div>
                
                
                <!-- Star Rating Section - Hidden by default -->
                <div id="rating-section" style="display: none; margin-top: 48px; padding: 40px; background: white; border-radius: 20px; border: 1px solid #e2e8f0; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.05); animation: slideDown 0.4s ease-out; max-width: 620px; margin-left: auto; margin-right: auto;">
                    <div style="text-align: center; margin-bottom: 32px;">
                        <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(245, 158, 11, 0.25);">
                            <i class="fas fa-star" style="font-size: 26px; color: white;"></i>
                        </div>
                        <h3 style="margin: 0 0 8px 0; font-size: 24px; color: #0f172a; font-weight: 700; letter-spacing: -0.02em;">How was your experience?</h3>
                        <p style="margin: 0; color: #64748b; font-size: 15px;">Your feedback helps us improve</p>
                    </div>
                    
                    <div id="star-rating" style="display: flex; justify-content: center; gap: 16px; margin-bottom: 24px;">
                        <i class="far fa-star rating-star" data-rating="1" onclick="survey.setRating(1)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                        <i class="far fa-star rating-star" data-rating="2" onclick="survey.setRating(2)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                        <i class="far fa-star rating-star" data-rating="3" onclick="survey.setRating(3)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                        <i class="far fa-star rating-star" data-rating="4" onclick="survey.setRating(4)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                        <i class="far fa-star rating-star" data-rating="5" onclick="survey.setRating(5)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                    </div>
                    
                    <p style="margin: 0; text-align: center; font-size: 14px; color: #94a3b8; font-weight: 500;">Click any star to submit</p>
                </div>
                
                <div class="privacy-reminder">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                    <div>
                        <strong>Your Privacy is Protected</strong>
                        <span>Your responses are confidential and will only be reported in aggregate form. Individual responses will not be publicly disclosed.</span>
                    </div>
                </div>
                
                <!-- Optional Prop 50 Supplement -->
                <div class="prop50-invitation" style="margin-top: 0; padding: 36px; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 20px; border: 1px solid #e2e8f0; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06), 0 1px 3px rgba(0, 0, 0, 0.05); animation: fadeIn 0.6s ease-out 0.6s both; max-width: 620px; margin-left: auto; margin-right: auto;">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: linear-gradient(135deg, #1e3a8a 0%, #1d4ed8 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(30, 58, 138, 0.25);">
                            <i class="fas fa-comment-dots" style="font-size: 26px; color: white;"></i>
                        </div>
                        <h3 style="margin: 0 0 8px 0; font-size: 24px; color: #0f172a; font-weight: 700; letter-spacing: -0.02em;">Keep the momentum going?</h3>
                        <p style="margin: 0; color: #64748b; font-size: 14px; font-weight: 600;">Optional • 12 questions • ~2 minutes</p>
                    </div>
                    
                    <p style="margin: 0 0 20px 0; color: #475569; line-height: 1.6; font-size: 16px; text-align: center;">Share your thoughts on <strong style="color: #1e3a8a;">Proposition 50</strong> — your opinion on how California's congressional districts are drawn could shape this critical November decision.</p>
                    
                    <div style="margin-bottom: 24px; padding: 16px 20px; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 12px; border: 1px solid #bfdbfe; display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-users" style="color: #2563eb; font-size: 18px; flex-shrink: 0;"></i>
                        <p style="margin: 0; font-size: 14px; color: #1e40af; font-weight: 600; line-height: 1.4;">92% of respondents continue through Prop 50 ✨</p>
                    </div>
                    
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button onclick="survey.startProp50()" class="prop50-continue-btn" style="flex: 1; min-width: 140px; padding: 16px 24px; font-size: 16px; font-weight: 700; background: linear-gradient(135deg, #1e3a8a 0%, #1d4ed8 100%); color: white; border: none; border-radius: 12px; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3); position: relative;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 16px rgba(30, 58, 138, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(30, 58, 138, 0.3)'">
                            <span style="position: relative; z-index: 1;">Continue Survey <i class="fas fa-arrow-right" style="margin-left: 8px;"></i></span>
                            <div style="position: absolute; top: -8px; right: -8px; background: #10b981; color: white; font-size: 11px; font-weight: 700; padding: 4px 8px; border-radius: 10px; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);">
                                +12
                            </div>
                        </button>
                        <button onclick="survey.showRating()" class="prop50-skip-btn" style="flex: 1; min-width: 140px; padding: 16px 24px; font-size: 15px; font-weight: 600; border: 1px solid #cbd5e1; background: white; color: #64748b; border-radius: 12px; cursor: pointer; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);" onmouseover="this.style.borderColor='#94a3b8'; this.style.backgroundColor='#f8fafc'" onmouseout="this.style.borderColor='#cbd5e1'; this.style.backgroundColor='white'">
                            Finish Now <i class="fas fa-check" style="margin-left: 8px;"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PROP 50 SUPPLEMENT QUESTIONS -->
        
        <!-- Prop 50 Q1: Awareness -->
        <div class="page hidden" id="page-prop50-q1">
            <div class="question-text">Before today, how much have you heard about <strong style="color: #1e3a8a;">Proposition 50</strong> on the November 2025 ballot?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q1" id="prop50-q1-1" value="A lot" onchange="survey.answerQuestion('prop50-q1', 'A lot')">
                    <label for="prop50-q1-1">A lot</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q1" id="prop50-q1-2" value="Some" onchange="survey.answerQuestion('prop50-q1', 'Some')">
                    <label for="prop50-q1-2">Some</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q1" id="prop50-q1-3" value="A little" onchange="survey.answerQuestion('prop50-q1', 'A little')">
                    <label for="prop50-q1-3">A little</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q1" id="prop50-q1-4" value="Nothing at all" onchange="survey.answerQuestion('prop50-q1', 'Nothing at all')">
                    <label for="prop50-q1-4">Nothing at all</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q2: Understanding -->
        <div class="page hidden" id="page-prop50-q2">
            <div class="question-text">How much of this did you already know?</div>
            
            <div class="prop50-info-box">
                <div class="prop50-info-header">
                    <i class="fas fa-info-circle"></i> About Prop 50:
                </div>
                <div class="prop50-info-content">
                    Proposition 50 would <strong style="color: #1e3a8a;">temporarily</strong> allow the <strong style="color: #1e3a8a;">state legislature</strong> to redraw California's congressional districts for elections from 2026-2030, instead of the current independent commission. The commission would resume control after 2030.
                </div>
            </div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q2" id="prop50-q2-1" value="Knew all of this" onchange="survey.answerQuestion('prop50-q2', 'Knew all of this')">
                    <label for="prop50-q2-1">Knew all of this</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q2" id="prop50-q2-2" value="Knew some of this" onchange="survey.answerQuestion('prop50-q2', 'Knew some of this')">
                    <label for="prop50-q2-2">Knew some of this</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q2" id="prop50-q2-3" value="This is mostly new to me" onchange="survey.answerQuestion('prop50-q2', 'This is mostly new to me')">
                    <label for="prop50-q2-3">This is mostly new to me</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q3: Initial Ballot -->
        <div class="page hidden" id="page-prop50-q3">
            <div class="question-text">If the election were held today, would you vote <strong style="color: #1e3a8a;">YES or NO</strong> on Proposition 50?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q3" id="prop50-q3-1" value="Definitely YES" onchange="survey.answerQuestion('prop50-q3', 'Definitely YES')">
                    <label for="prop50-q3-1">Definitely YES</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q3" id="prop50-q3-2" value="Probably YES" onchange="survey.answerQuestion('prop50-q3', 'Probably YES')">
                    <label for="prop50-q3-2">Probably YES</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q3" id="prop50-q3-3" value="Undecided" onchange="survey.answerQuestion('prop50-q3', 'Undecided')">
                    <label for="prop50-q3-3">Undecided</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q3" id="prop50-q3-4" value="Probably NO" onchange="survey.answerQuestion('prop50-q3', 'Probably NO')">
                    <label for="prop50-q3-4">Probably NO</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q3" id="prop50-q3-5" value="Definitely NO" onchange="survey.answerQuestion('prop50-q3', 'Definitely NO')">
                    <label for="prop50-q3-5">Definitely NO</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q4: PRO Argument Test (Texas Response) -->
        <div class="page hidden" id="page-prop50-q4">
            <div class="question-text">Does this argument make you more or less likely to support Prop 50?</div>
            
            <div class="prop50-argument-box prop50-supporters">
                <div class="prop50-argument-header">
                    <i class="fas fa-thumbs-up"></i> Supporters say:
                </div>
                <div class="prop50-argument-content">
                    Texas and other Republican states just redrew their congressional maps mid-decade to gain more seats. Prop 50 lets California respond to protect our representation in Congress and isn't fair to let other states cheat while we don't.
                </div>
            </div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q4" id="prop50-q4-1" value="Much more likely to support" onchange="survey.answerQuestion('prop50-q4', 'Much more likely to support')">
                    <label for="prop50-q4-1">Much more likely to support</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q4" id="prop50-q4-2" value="Somewhat more likely" onchange="survey.answerQuestion('prop50-q4', 'Somewhat more likely')">
                    <label for="prop50-q4-2">Somewhat more likely</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q4" id="prop50-q4-3" value="Makes no difference" onchange="survey.answerQuestion('prop50-q4', 'Makes no difference')">
                    <label for="prop50-q4-3">Makes no difference</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q4" id="prop50-q4-4" value="Somewhat less likely" onchange="survey.answerQuestion('prop50-q4', 'Somewhat less likely')">
                    <label for="prop50-q4-4">Somewhat less likely</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q4" id="prop50-q4-5" value="Much less likely to support" onchange="survey.answerQuestion('prop50-q4', 'Much less likely to support')">
                    <label for="prop50-q4-5">Much less likely to support</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q5: ANTI Argument Test (Independent Commission) -->
        <div class="page hidden" id="page-prop50-q5">
            <div class="question-text">Does this argument make you more or less likely to support Prop 50?</div>
            
            <div class="prop50-argument-box prop50-opponents">
                <div class="prop50-argument-header">
                    <i class="fas fa-thumbs-down"></i> Opponents say:
                </div>
                <div class="prop50-argument-content">
                    Voters created an independent commission in 2008 specifically to stop politicians from drawing their own districts. Prop 50 gives that power back to politicians and opens the door to partisan gerrymandering.
                </div>
            </div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q5" id="prop50-q5-1" value="Much more likely to support" onchange="survey.answerQuestion('prop50-q5', 'Much more likely to support')">
                    <label for="prop50-q5-1">Much more likely to support</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q5" id="prop50-q5-2" value="Somewhat more likely" onchange="survey.answerQuestion('prop50-q5', 'Somewhat more likely')">
                    <label for="prop50-q5-2">Somewhat more likely</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q5" id="prop50-q5-3" value="Makes no difference" onchange="survey.answerQuestion('prop50-q5', 'Makes no difference')">
                    <label for="prop50-q5-3">Makes no difference</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q5" id="prop50-q5-4" value="Somewhat less likely" onchange="survey.answerQuestion('prop50-q5', 'Somewhat less likely')">
                    <label for="prop50-q5-4">Somewhat less likely</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q5" id="prop50-q5-5" value="Much less likely to support" onchange="survey.answerQuestion('prop50-q5', 'Much less likely to support')">
                    <label for="prop50-q5-5">Much less likely to support</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q6: Trust in Institutions -->
        <div class="page hidden" id="page-prop50-q6">
            <div class="question-text">Who do you trust <strong style="color: #1e3a8a;">more</strong> to draw fair congressional district maps for California?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q6" id="prop50-q6-1" value="State legislature much more" onchange="survey.answerQuestion('prop50-q6', 'State legislature much more')">
                    <label for="prop50-q6-1">State legislature much more</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q6" id="prop50-q6-2" value="State legislature somewhat more" onchange="survey.answerQuestion('prop50-q6', 'State legislature somewhat more')">
                    <label for="prop50-q6-2">State legislature somewhat more</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q6" id="prop50-q6-3" value="About the same" onchange="survey.answerQuestion('prop50-q6', 'About the same')">
                    <label for="prop50-q6-3">About the same</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q6" id="prop50-q6-4" value="Independent commission somewhat more" onchange="survey.answerQuestion('prop50-q6', 'Independent commission somewhat more')">
                    <label for="prop50-q6-4">Independent commission somewhat more</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q6" id="prop50-q6-5" value="Independent commission much more" onchange="survey.answerQuestion('prop50-q6', 'Independent commission much more')">
                    <label for="prop50-q6-5">Independent commission much more</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q7: Temporary Promise -->
        <div class="page hidden" id="page-prop50-q7">
            <div class="question-text">Prop 50 says the legislature's control would be <strong style="color: #1e3a8a;">temporary</strong> (2026-2030), then power returns to the independent commission. How much do you trust this promise?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q7" id="prop50-q7-1" value="Completely trust" onchange="survey.answerQuestion('prop50-q7', 'Completely trust')">
                    <label for="prop50-q7-1">Completely trust it</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q7" id="prop50-q7-2" value="Mostly trust" onchange="survey.answerQuestion('prop50-q7', 'Mostly trust')">
                    <label for="prop50-q7-2">Mostly trust it</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q7" id="prop50-q7-3" value="Somewhat trust" onchange="survey.answerQuestion('prop50-q7', 'Somewhat trust')">
                    <label for="prop50-q7-3">Somewhat trust it</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q7" id="prop50-q7-4" value="Don't trust much" onchange="survey.answerQuestion('prop50-q7', 'Don\'t trust much')">
                    <label for="prop50-q7-4">Don't trust it much</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q7" id="prop50-q7-5" value="Don't trust at all" onchange="survey.answerQuestion('prop50-q7', 'Don\'t trust at all')">
                    <label for="prop50-q7-5">Don't trust it at all</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q8: Partisan Fairness -->
        <div class="page hidden" id="page-prop50-q8">
            <div class="question-text">Which is <strong style="color: #1e3a8a;">more important</strong> to you when it comes to redistricting?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q8" id="prop50-q8-1" value="CA fights back when other states cheat" onchange="survey.answerQuestion('prop50-q8', 'CA fights back when other states cheat')">
                    <label for="prop50-q8-1">California fights back when other states cheat the system</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q8" id="prop50-q8-2" value="Keep independent commission no matter what" onchange="survey.answerQuestion('prop50-q8', 'Keep independent commission no matter what')">
                    <label for="prop50-q8-2">Keep the independent commission no matter what</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q8" id="prop50-q8-3" value="Both equally important" onchange="survey.answerQuestion('prop50-q8', 'Both equally important')">
                    <label for="prop50-q8-3">Both are equally important</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q8" id="prop50-q8-4" value="Neither matters much to me" onchange="survey.answerQuestion('prop50-q8', 'Neither matters much to me')">
                    <label for="prop50-q8-4">Neither matters much to me</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q9: Vote Likelihood -->
        <div class="page hidden" id="page-prop50-q9">
            <div class="question-text">How likely are you to vote in the <strong style="color: #1e3a8a;">November 2025</strong> special election on Proposition 50?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q9" id="prop50-q9-1" value="Definitely will vote" onchange="survey.answerQuestion('prop50-q9', 'Definitely will vote')">
                    <label for="prop50-q9-1">Definitely will vote</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q9" id="prop50-q9-2" value="Probably will vote" onchange="survey.answerQuestion('prop50-q9', 'Probably will vote')">
                    <label for="prop50-q9-2">Probably will vote</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q9" id="prop50-q9-3" value="50-50 chance" onchange="survey.answerQuestion('prop50-q9', '50-50 chance')">
                    <label for="prop50-q9-3">50-50 chance</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q9" id="prop50-q9-4" value="Probably won't vote" onchange="survey.answerQuestion('prop50-q9', 'Probably won\'t vote')">
                    <label for="prop50-q9-4">Probably won't vote</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q9" id="prop50-q9-5" value="Definitely won't vote" onchange="survey.answerQuestion('prop50-q9', 'Definitely won\'t vote')">
                    <label for="prop50-q9-5">Definitely won't vote</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q10: Informed Ballot -->
        <div class="page hidden" id="page-prop50-q10">
            <div class="question-text"><strong style="color: #1e3a8a;">Now that you've considered both sides,</strong> if the election were held today, would you vote YES or NO on Proposition 50?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q10" id="prop50-q10-1" value="Definitely YES" onchange="survey.answerQuestion('prop50-q10', 'Definitely YES')">
                    <label for="prop50-q10-1">Definitely YES</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q10" id="prop50-q10-2" value="Probably YES" onchange="survey.answerQuestion('prop50-q10', 'Probably YES')">
                    <label for="prop50-q10-2">Probably YES</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q10" id="prop50-q10-3" value="Undecided" onchange="survey.answerQuestion('prop50-q10', 'Undecided')">
                    <label for="prop50-q10-3">Undecided</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q10" id="prop50-q10-4" value="Probably NO" onchange="survey.answerQuestion('prop50-q10', 'Probably NO')">
                    <label for="prop50-q10-4">Probably NO</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q10" id="prop50-q10-5" value="Definitely NO" onchange="survey.answerQuestion('prop50-q10', 'Definitely NO')">
                    <label for="prop50-q10-5">Definitely NO</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q11: Support Intensity -->
        <div class="page hidden" id="page-prop50-q11">
            <div class="question-text">How <strong style="color: #1e3a8a;">strongly</strong> do you feel about your vote on Prop 50?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q11" id="prop50-q11-1" value="Extremely strongly" onchange="survey.answerQuestion('prop50-q11', 'Extremely strongly')">
                    <label for="prop50-q11-1">Extremely strongly</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q11" id="prop50-q11-2" value="Very strongly" onchange="survey.answerQuestion('prop50-q11', 'Very strongly')">
                    <label for="prop50-q11-2">Very strongly</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q11" id="prop50-q11-3" value="Somewhat strongly" onchange="survey.answerQuestion('prop50-q11', 'Somewhat strongly')">
                    <label for="prop50-q11-3">Somewhat strongly</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q11" id="prop50-q11-4" value="Not very strongly" onchange="survey.answerQuestion('prop50-q11', 'Not very strongly')">
                    <label for="prop50-q11-4">Not very strongly</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q11" id="prop50-q11-5" value="Not at all strongly" onchange="survey.answerQuestion('prop50-q11', 'Not at all strongly')">
                    <label for="prop50-q11-5">Not at all strongly / Could change my mind</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Q12: Most Important Factor -->
        <div class="page hidden" id="page-prop50-q12">
            <div class="question-text">What was the <strong style="color: #1e3a8a;">MOST important factor</strong> in your decision about Prop 50?</div>
            
            <div class="answer-options">
                <div class="answer-option">
                    <input type="radio" name="prop50-q12" id="prop50-q12-1" value="Trust in independent commission" onchange="survey.answerQuestion('prop50-q12', 'Trust in independent commission')">
                    <label for="prop50-q12-1">Trust in independent commission over politicians</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q12" id="prop50-q12-2" value="Need to respond to Texas" onchange="survey.answerQuestion('prop50-q12', 'Need to respond to Texas')">
                    <label for="prop50-q12-2">Need to respond to what Texas did</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q12" id="prop50-q12-3" value="Concern about gerrymandering" onchange="survey.answerQuestion('prop50-q12', 'Concern about gerrymandering')">
                    <label for="prop50-q12-3">Concern about gerrymandering</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q12" id="prop50-q12-4" value="Temporary nature reassuring" onchange="survey.answerQuestion('prop50-q12', 'Temporary nature reassuring')">
                    <label for="prop50-q12-4">It's temporary (ends in 2030)</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q12" id="prop50-q12-5" value="Party affiliation" onchange="survey.answerQuestion('prop50-q12', 'Party affiliation')">
                    <label for="prop50-q12-5">My political party's position</label>
                </div>
                <div class="answer-option">
                    <input type="radio" name="prop50-q12" id="prop50-q12-6" value="Other" onchange="survey.answerQuestion('prop50-q12', 'Other')">
                    <label for="prop50-q12-6">Something else</label>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Complete -->
        <div class="page hidden" id="page-prop50-complete">
            <div class="thank-you-container">
                <!-- Confetti Container -->
                <div id="confetti-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></div>
                
                <!-- Super Respondent Badge -->
                <div style="margin-bottom: 40px; animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);">
                    <div style="width: 120px; height: 120px; margin: 0 auto; background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 60px; box-shadow: 0 12px 40px rgba(245, 158, 11, 0.4); position: relative;">
                        🌟
                        <div style="position: absolute; top: -8px; right: -8px; width: 44px; height: 44px; background: #10b981; border-radius: 50%; border: 4px solid white; display: flex; align-items: center; justify-content: center; font-size: 22px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                            ✓
                        </div>
                    </div>
                </div>
                
                <h1 class="thank-you-title" style="font-size: 32px; margin-bottom: 16px;">Super Respondent! 🎉</h1>
                <p class="thank-you-subtitle" style="font-size: 18px; margin-bottom: 40px;">You completed BOTH surveys! Your insights are incredibly valuable.</p>
                
                <div style="background: white; border: 1px solid #fbbf24; border-radius: 20px; padding: 32px; margin-bottom: 40px; box-shadow: 0 4px 16px rgba(251, 191, 36, 0.15), 0 1px 3px rgba(0, 0, 0, 0.05); max-width: 500px; margin-left: auto; margin-right: auto;">
                    <div style="display: flex; justify-content: space-around; text-align: center; align-items: center;">
                        <div>
                            <div style="font-size: 40px; font-weight: 800; background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">31</div>
                            <div style="font-size: 13px; color: #78350f; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px;">Questions</div>
                        </div>
                        <div style="width: 2px; height: 60px; background: linear-gradient(to bottom, transparent, #fbbf24 20%, #fbbf24 80%, transparent);"></div>
                        <div>
                            <div id="total-completion-time" style="font-size: 40px; font-weight: 800; background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">—</div>
                            <div style="font-size: 13px; color: #78350f; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px;">Minutes</div>
                        </div>
                        <div style="width: 2px; height: 60px; background: linear-gradient(to bottom, transparent, #fbbf24 20%, #fbbf24 80%, transparent);"></div>
                        <div>
                            <div style="font-size: 40px;">🏆</div>
                            <div style="font-size: 13px; color: #78350f; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px;">MVP Status</div>
                        </div>
                    </div>
                </div>
                
                <div class="privacy-reminder">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                    <div>
                        <strong>Your Privacy is Protected</strong>
                        <span>All 31 responses are confidential and secure. You're making a real difference!</span>
                    </div>
                </div>
                
                <!-- Star Rating Section for Prop 50 Completion -->
                <div id="rating-section-prop50" style="display: none; margin-top: 48px; padding: 40px; background: white; border-radius: 20px; border: 1px solid #e2e8f0; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.05); animation: slideDown 0.4s ease-out; max-width: 620px; margin-left: auto; margin-right: auto;">
                    <div style="text-align: center; margin-bottom: 32px;">
                        <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(245, 158, 11, 0.25);">
                            <i class="fas fa-star" style="font-size: 26px; color: white;"></i>
                        </div>
                        <h3 style="margin: 0 0 8px 0; font-size: 24px; color: #0f172a; font-weight: 700; letter-spacing: -0.02em;">How was your experience?</h3>
                        <p style="margin: 0; color: #64748b; font-size: 15px;">Your feedback helps us improve</p>
                    </div>
                    <div id="star-rating-prop50" style="display: flex; justify-content: center; gap: 16px; margin-bottom: 24px;">
                        <i class="far fa-star rating-star" data-rating="1" onclick="survey.setRatingProp50(1)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                        <i class="far fa-star rating-star" data-rating="2" onclick="survey.setRatingProp50(2)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                        <i class="far fa-star rating-star" data-rating="3" onclick="survey.setRatingProp50(3)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                        <i class="far fa-star rating-star" data-rating="4" onclick="survey.setRatingProp50(4)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                        <i class="far fa-star rating-star" data-rating="5" onclick="survey.setRatingProp50(5)" style="font-size: 48px; color: #cbd5e1; cursor: pointer; transition: all 0.2s;"></i>
                    </div>
                    <p style="margin: 0; text-align: center; font-size: 14px; color: #94a3b8; font-weight: 500;">Click any star to submit</p>
                </div>
            </div>
        </div>
        
        <!-- Prop 50 Terminated -->
        <div class="page hidden" id="page-prop50-terminated">
            <div class="thank-you-container" style="padding-top: 80px;">
                <div style="width: 80px; height: 80px; margin: 0 auto 32px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.25);">
                    <i class="fas fa-check" style="font-size: 40px; color: white;"></i>
                </div>
                
                <h1 class="thank-you-title" style="margin-bottom: 16px;">Thank You!</h1>
                <p class="thank-you-subtitle" style="margin-bottom: 48px;">We appreciate your time and thoughtful responses</p>
                
                <div class="privacy-reminder">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                    <div>
                        <strong>Your Privacy is Protected</strong>
                        <span>Your responses have been recorded confidentially and will only be reported in aggregate form.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen-out: No Consent -->
        <div class="page hidden" id="page-screenout-consent">
            <div class="screen-out-box">
                <div style="width: 80px; height: 80px; margin: 0 auto 32px; background: linear-gradient(135deg, #64748b 0%, #475569 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(100, 116, 139, 0.2);">
                    <i class="fas fa-info" style="font-size: 40px; color: white;"></i>
                </div>
                <h2>Thank You for Your Interest</h2>
                <p>Unfortunately, you are not eligible to participate in this particular survey. We appreciate your time and interest in our research.</p>
            </div>
        </div>

        <!-- Screen-out: Not Registered -->
        <div class="page hidden" id="page-screenout-registration">
            <div class="screen-out-box">
                <div style="width: 80px; height: 80px; margin: 0 auto 32px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);">
                    <i class="fas fa-vote-yea" style="font-size: 40px; color: white;"></i>
                </div>
                <h2>Thank You for Your Interest</h2>
                <p>This survey is specifically for registered California voters. Unfortunately, you do not meet the eligibility criteria at this time.</p>
                <a href="https://registertovote.ca.gov" target="_blank" rel="noopener noreferrer" class="info-link">Register to Vote in California <i class="fas fa-arrow-right" style="margin-left: 8px;"></i></a>
            </div>
        </div>
    </div>

    <script>
        // Production Configuration
        const PRODUCTION_MODE = true; // Set to false for development debugging
        const DEBUG = !PRODUCTION_MODE;
        
        // Safe console wrapper
        const log = {
            info: (...args) => DEBUG && console.log(...args),
            error: (...args) => DEBUG && console.error(...args),
            warn: (...args) => DEBUG && console.warn(...args)
        };
        
        const survey = {
            currentPage: 0,
            responses: {},
            startTime: Date.now(),
            pageSequence: ['welcome', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q7a', 'q8', 'q9', 'q10', 'q11', 'q12', 'q13', 'q14', 'q15', 'q16', 'q17', 'q18', 'q19', 'thankyou'],
            questionOrder: [],
            sessionId: null,
            respondentId: null,
            sessionFingerprint: null,
            
            init: function() {
                // Capture URL parameters for P2P matching
                this.captureURLParams();
                
                // Generate session fingerprint
                this.generateSessionFingerprint();
                
                // Capture IP address
                this.captureIPAddress();
                
                this.loadProgress();
                this.randomizeQuestions();
                this.randomizeAnswerOptions();
                this.showCurrentPage();
            },
            
            captureURLParams: function() {
                const urlParams = new URLSearchParams(window.location.search);
                
                // Capture respondent ID (passed from P2P SMS link)
                this.respondentId = urlParams.get('rid') || urlParams.get('id') || urlParams.get('respondent_id') || null;
                
                // Generate unique session ID
                this.sessionId = this.generateSessionId();
                
                // Store in responses for export
                this.responses._metadata = {
                    sessionId: this.sessionId,
                    respondentId: this.respondentId,
                    startTime: new Date().toISOString(),
                    startTimestamp: this.startTime,
                    referrer: document.referrer || 'direct',
                    userAgent: navigator.userAgent,
                    screenResolution: `${window.screen.width}x${window.screen.height}`,
                    viewportSize: `${window.innerWidth}x${window.innerHeight}`,
                    platform: navigator.platform,
                    language: navigator.language
                };
            },
            
            generateSessionId: function() {
                return 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            },
            
            generateSessionFingerprint: function() {
                // Create a browser fingerprint for deduplication
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('fingerprint', 2, 2);
                
                this.sessionFingerprint = {
                    canvas: canvas.toDataURL().slice(-50),
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    timezoneOffset: new Date().getTimezoneOffset(),
                    plugins: Array.from(navigator.plugins || []).map(p => p.name).join(',').slice(0, 100),
                    hardwareConcurrency: navigator.hardwareConcurrency || 'unknown',
                    deviceMemory: navigator.deviceMemory || 'unknown',
                    touchSupport: 'ontouchstart' in window
                };
                
                this.responses._metadata.fingerprint = this.sessionFingerprint;
            },
            
            captureIPAddress: function() {
                // Capture IP address via API
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        this.responses._metadata.ipAddress = data.ip;
                        this.saveProgress();
                    })
                    .catch(() => {
                        this.responses._metadata.ipAddress = 'unavailable';
                    });
            },
            
            randomizeQuestions: function() {
                // Randomize leader eval questions (Trump, Newsom approval, Newsom 2028)
                const leaderQuestions = ['q5', 'q6', 'q7'];
                const shuffled = this.shuffle([...leaderQuestions]);
                
                // Randomize demographic order
                const demoQuestions = ['q16', 'q17', 'q18', 'q19'];
                const shuffledDemos = this.shuffle([...demoQuestions]);
                
                // Store question order for analysis
                this.responses._questionOrder = {
                    leaderQuestions: shuffled,
                    demographicQuestions: shuffledDemos
                };
                
                // Build final sequence
                this.pageSequence = [
                    'welcome',
                    'q2',  // Vote Likelihood
                    'q3',  // Country Direction
                    'q4',  // CA Direction
                    ...shuffled,  // Randomized leader questions (Trump, Newsom approval, Newsom 2028)
                    'q7a', // Newsom National Leadership
                    'q8',  // Party ID
                    'q9',  // Ideology
                    'q10', // CA's Biggest Problem
                    'q11', // Newsom Worst Issue
                    'q12', // Newsom Best Issue
                    'q13', // Balanced Overall Assessment
                    'q14', // Congressional Vote
                    'q15', // News Source
                    ...shuffledDemos, // Randomized demographics
                    'thankyou'
                ];
                
                // Store order for analysis
                this.questionOrder = shuffled;
            },
            
            randomizeAnswerOptions: function() {
                // Binary questions: randomize first 2 options
                const binaryQuestions = ['q3', 'q4', 'q8', 'q14'];
                
                binaryQuestions.forEach(qId => {
                    const container = document.getElementById(`${qId}-options`);
                    if (!container) return;
                    
                    const options = Array.from(container.querySelectorAll('.answer-option[data-order]'));
                    
                    if (options.length >= 2 && Math.random() < 0.5) {
                        const first = options[0];
                        const second = options[1];
                        container.insertBefore(second, first);
                        
                        if (!this.responses.randomization) {
                            this.responses.randomization = {};
                        }
                        this.responses.randomization[qId] = 'reversed';
                    } else {
                        if (!this.responses.randomization) {
                            this.responses.randomization = {};
                        }
                        this.responses.randomization[qId] = 'standard';
                    }
                });
                
                // Approval questions: randomize approve/disapprove blocks
                const approvalQuestions = ['q5', 'q6'];
                
                approvalQuestions.forEach(qId => {
                    const container = document.getElementById(`${qId}-options`);
                    if (!container) return;
                    
                    const options = Array.from(container.querySelectorAll('.answer-option[data-order]'));
                    
                    if (options.length >= 4 && Math.random() < 0.5) {
                        // Swap approve block (first 2) with disapprove block (next 2)
                        const approve1 = options[0];
                        const approve2 = options[1];
                        const disapprove1 = options[2];
                        const disapprove2 = options[3];
                        
                        // Insert disapprove options first
                        container.insertBefore(disapprove2, approve1);
                        container.insertBefore(disapprove1, disapprove2);
                        
                        if (!this.responses.randomization) {
                            this.responses.randomization = {};
                        }
                        this.responses.randomization[qId] = 'disapprove-first';
                    } else {
                        if (!this.responses.randomization) {
                            this.responses.randomization = {};
                        }
                        this.responses.randomization[qId] = 'approve-first';
                    }
                });
                
                // Issue battery: randomize ONCE, apply to Q10, Q11, Q12
                const issueQuestions = ['q10', 'q11', 'q12'];
                
                // Get issues from first question and shuffle them
                const firstContainer = document.getElementById('q10-options');
                if (firstContainer) {
                    const issueOptions = Array.from(firstContainer.querySelectorAll('.answer-option[data-issue-order]'));
                    const shuffledIssues = this.shuffle([...issueOptions]);
                    
                    // Apply same order to all 3 questions
                    issueQuestions.forEach(qId => {
                        const container = document.getElementById(`${qId}-options`);
                        if (!container) return;
                        
                        const issues = Array.from(container.querySelectorAll('.answer-option[data-issue-order]'));
                        const noneOption = container.querySelector('.answer-option:not([data-issue-order])');
                        
                        // Get the shuffled order from first question
                        const orderMap = new Map();
                        shuffledIssues.forEach((el, index) => {
                            const issueOrder = el.getAttribute('data-issue-order');
                            orderMap.set(issueOrder, index);
                        });
                        
                        // Sort this question's issues by the shuffled order
                        issues.sort((a, b) => {
                            const aOrder = orderMap.get(a.getAttribute('data-issue-order'));
                            const bOrder = orderMap.get(b.getAttribute('data-issue-order'));
                            return aOrder - bOrder;
                        });
                        
                        // Clear container and re-insert in new order
                        container.innerHTML = '';
                        issues.forEach(issue => container.appendChild(issue));
                        
                        // Add "none" option back at the end
                        if (noneOption) {
                            container.appendChild(noneOption);
                        }
                    });
                    
                    // Record issue order for analysis
                    if (!this.responses.randomization) {
                        this.responses.randomization = {};
                    }
                    this.responses.randomization.issueOrder = shuffledIssues.map(el => 
                        el.querySelector('input').value
                    );
                }
            },
            
            shuffle: function(array) {
                const arr = [...array];
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            },
            
            showCurrentPage: function() {
                const pageId = this.pageSequence[this.currentPage];
                const pages = document.querySelectorAll('.page');
                
                pages.forEach(page => {
                    page.classList.add('hidden');
                });
                
                const currentPageEl = document.getElementById('page-' + pageId);
                if (currentPageEl) {
                    currentPageEl.classList.remove('hidden');
                    window.scrollTo(0, 0);
                }
                
                this.updateProgress();
            },
            
            giveConsent: function() {
                // Record implicit consent by clicking Begin Survey
                this.responses.consent = {
                    answer: 'Yes',
                    timestamp: Date.now() - this.startTime,
                    method: 'implicit_button_click'
                };
                this.responses.eligibility_confirmed = {
                    age18: true,
                    registeredVoter: true,
                    timestamp: Date.now() - this.startTime
                };
                
                // Show progress indicators when starting survey
                document.querySelector('.progress-bar-container').style.opacity = '1';
                document.getElementById('progressText').style.opacity = '1';
                
                // Save immediately
                this.saveProgress();
                
                // Show instructions modal instead of immediately advancing
                this.showInstructions();
            },
            
            showInstructions: function() {
                const modal = document.getElementById('instructions-modal');
                if (modal) {
                    modal.classList.add('active');
                }
            },
            
            closeInstructions: function() {
                const modal = document.getElementById('instructions-modal');
                if (modal) {
                    modal.classList.remove('active');
                }
                
                // Now advance to first question
                setTimeout(() => {
                    this.nextPage();
                }, 200);
            },
            
            nextPage: function() {
                // Check if we're in Prop 50 flow
                if (this.prop50Sequence && this.prop50CurrentPage !== undefined) {
                    const currentPageEl = document.getElementById('page-' + this.prop50Sequence[this.prop50CurrentPage]);
                    if (currentPageEl) {
                        currentPageEl.classList.add('fade-out');
                    }
                    
                    setTimeout(() => {
                        this.prop50CurrentPage++;
                        if (this.prop50CurrentPage < this.prop50Sequence.length) {
                            this.showPage(this.prop50Sequence[this.prop50CurrentPage]);
                        }
                        this.saveProgress();
                    }, 250);
                } else {
                    // Main survey flow
                    const currentPageEl = document.getElementById('page-' + this.pageSequence[this.currentPage]);
                    if (currentPageEl) {
                        currentPageEl.classList.add('fade-out');
                    }
                    
                    setTimeout(() => {
                        this.currentPage++;
                        this.showCurrentPage();
                        this.saveProgress();
                    }, 250);
                }
            },
            
            answerQuestion: function(question, answer, terminate = false) {
                // Record response
                this.responses[question] = {
                    answer: answer,
                    timestamp: Date.now() - this.startTime
                };
                
                // Get EXACT element that was clicked
                const clickedInput = event && event.target ? event.target : document.querySelector(`input[name="${question}"][value="${answer}"]`);
                if (!clickedInput) {
                    log.error('Could not find clicked input!');
                    this.nextPage();
                    return;
                }
                
                const clickedLabel = clickedInput.nextElementSibling;
                const parentOption = clickedInput.closest('.answer-option');
                
                log.info('Clicked:', clickedInput, clickedLabel, parentOption);
                
                if (!clickedLabel || !parentOption) {
                    log.error('Missing label or parent!');
                    this.nextPage();
                    return;
                }
                
                // Get the current question container
                const currentPage = document.getElementById(`page-${this.pageSequence[this.currentPage]}`);
                
                // Remove ALL previous highlights from ALL labels on this page
                if (currentPage) {
                    const allLabels = currentPage.querySelectorAll('.answer-option label');
                    allLabels.forEach(label => {
                        label.style.background = '';
                        label.style.borderColor = '';
                        label.style.color = '';
                        label.style.fontWeight = '';
                        const beforeEl = label.querySelector('.answer-checkmark');
                        if (beforeEl) beforeEl.remove();
                    });
                }
                
                // INSTANT selection - dopamine hit
                clickedLabel.style.background = '#1e3a8a';
                clickedLabel.style.borderColor = '#1e3a8a';
                clickedLabel.style.color = 'white';
                clickedLabel.style.fontWeight = '600';
                
                // Instant checkmark
                const checkmark = document.createElement('div');
                checkmark.className = 'answer-checkmark';
                checkmark.innerHTML = '✓';
                checkmark.style.cssText = 'position: absolute; right: 24px; top: 50%; transform: translateY(-50%); color: white; font-size: 24px; font-weight: 900;';
                clickedLabel.appendChild(checkmark);
                
                // Handle terminates for Prop 50 supplement
                if (terminate && question.startsWith('prop50-')) {
                    setTimeout(() => {
                        this.showPage('prop50-terminated');
                        this.responses.prop50_terminated = true;
                        this.saveResults();
                    }, 800);
                    return;
                }
                
                // Auto-advance - FAST dopamine flow
                setTimeout(() => {
                    this.nextPage();
                }, 180);
                
                // Save to localStorage
                this.saveProgress();
            },
            
            screenOut: function(reason) {
                setTimeout(() => {
                    const pages = document.querySelectorAll('.page');
                    pages.forEach(page => page.classList.add('hidden'));
                    
                    const screenoutPage = document.getElementById('page-screenout-' + reason);
                    if (screenoutPage) {
                        screenoutPage.classList.remove('hidden');
                    }
                    
                    this.responses.screenout = reason;
                    this.responses.completed = false;
                    this.saveResults();
                }, 400);
            },
            
            // Rating Functions
            showRating: function() {
                // Hide the Prop 50 invitation
                const invitation = document.querySelector('.prop50-invitation');
                if (invitation) {
                    invitation.style.transition = 'opacity 0.3s, transform 0.3s';
                    invitation.style.opacity = '0';
                    invitation.style.transform = 'translateY(-10px)';
                    setTimeout(() => {
                        invitation.style.display = 'none';
                    }, 300);
                }
                
                // Show rating section after brief delay
                setTimeout(() => {
                    const ratingSection = document.getElementById('rating-section');
                    if (ratingSection) {
                        ratingSection.style.display = 'block';
                        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                    }
                }, 400);
            },
            
            setRating: function(rating) {
                this.selectedRating = rating;
                
                // Update star visuals
                const stars = document.querySelectorAll('#star-rating .rating-star');
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.classList.remove('far');
                        star.classList.add('fas');
                        star.style.color = '#f59e0b';
                        star.style.transform = 'scale(1.1)';
                    } else {
                        star.classList.remove('fas');
                        star.classList.add('far');
                        star.style.color = '#cbd5e1';
                        star.style.transform = 'scale(1)';
                    }
                });
                
                // Auto-submit after brief moment - no button needed
                clearTimeout(this.ratingTimeout);
                this.ratingTimeout = setTimeout(() => {
                    this.submitRating();
                }, 800);
            },
            
            submitRating: function() {
                // Save rating
                this.responses._surveyRating = {
                    rating: this.selectedRating || 0,
                    timestamp: Date.now() - this.startTime
                };
                this.saveResults();
                
                // Trigger confetti celebration!
                this.triggerCompletionConfetti();
                
                // Hide rating section with success animation
                const ratingSection = document.getElementById('rating-section');
                if (ratingSection) {
                    ratingSection.style.transition = 'opacity 0.3s, transform 0.3s';
                    ratingSection.style.opacity = '0';
                    ratingSection.style.transform = 'scale(0.95)';
                }
                
                // Show final success message
                setTimeout(() => {
                    if (ratingSection) {
                        ratingSection.innerHTML = `
                            <div id="completion-confetti" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></div>
                            <div style="text-align: center; padding: 40px 20px; position: relative; z-index: 10000;">
                                <div style="width: 100px; height: 100px; margin: 0 auto 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55), pulseGlow 2s ease-in-out infinite; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4);">
                                    <i class="fas fa-check" style="font-size: 52px; color: white;"></i>
                                </div>
                                <h2 style="margin: 0 0 12px 0; font-size: 32px; color: #0f172a; font-weight: 700; animation: slideInUp 0.6s ease-out;">All Set!</h2>
                                <p style="margin: 0; color: #64748b; font-size: 18px; animation: fadeIn 0.8s ease-out;">Thank you for your valuable participation.</p>
                                <p style="margin: 16px 0 0 0; color: #059669; font-size: 16px; font-weight: 600; animation: fadeIn 1s ease-out;">Your voice matters. 🎉</p>
                            </div>
                        `;
                        ratingSection.style.opacity = '1';
                        ratingSection.style.transform = 'scale(1)';
                    }
                }, 300);
            },
            
            setRatingProp50: function(rating) {
                this.selectedRatingProp50 = rating;
                
                // Update star visuals for Prop 50 rating
                const stars = document.querySelectorAll('#star-rating-prop50 .rating-star');
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.classList.remove('far');
                        star.classList.add('fas');
                        star.style.color = '#f59e0b';
                        star.style.transform = 'scale(1.1)';
                    } else {
                        star.classList.remove('fas');
                        star.classList.add('far');
                        star.style.color = '#cbd5e1';
                        star.style.transform = 'scale(1)';
                    }
                });
                
                // Auto-submit after brief moment - no button needed
                clearTimeout(this.ratingTimeoutProp50);
                this.ratingTimeoutProp50 = setTimeout(() => {
                    this.submitRatingProp50();
                }, 800);
            },
            
            submitRatingProp50: function() {
                // Save Prop 50 rating
                this.responses._prop50Rating = {
                    rating: this.selectedRatingProp50 || 0,
                    timestamp: Date.now() - this.startTime
                };
                this.saveResults();
                
                // Trigger confetti celebration!
                this.triggerCompletionConfetti();
                
                // Hide rating section with success animation
                const ratingSection = document.getElementById('rating-section-prop50');
                if (ratingSection) {
                    ratingSection.style.transition = 'opacity 0.3s, transform 0.3s';
                    ratingSection.style.opacity = '0';
                    ratingSection.style.transform = 'scale(0.95)';
                }
                
                // Show final success message
                setTimeout(() => {
                    if (ratingSection) {
                        ratingSection.innerHTML = `
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="width: 100px; height: 100px; margin: 0 auto 24px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55), pulseGlow 2s ease-in-out infinite; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4);">
                                    <i class="fas fa-check" style="font-size: 52px; color: white;"></i>
                                </div>
                                <h2 style="margin: 0 0 12px 0; font-size: 32px; color: #0f172a; font-weight: 700; animation: slideInUp 0.6s ease-out;">All Set!</h2>
                                <p style="margin: 0; color: #64748b; font-size: 18px; animation: fadeIn 0.8s ease-out;">Thank you for your valuable participation.</p>
                                <p style="margin: 16px 0 0 0; color: #059669; font-size: 16px; font-weight: 600; animation: fadeIn 1s ease-out;">Your voice matters. 🎉</p>
                            </div>
                        `;
                        ratingSection.style.opacity = '1';
                        ratingSection.style.transform = 'scale(1)';
                    }
                }, 300);
            },
            
            triggerMainConfetti: function() {
                const colors = ['#3b82f6', '#1e3a8a', '#f59e0b', '#60a5fa', '#8b5cf6', '#ec4899'];
                const confettiCount = 100;
                const container = document.getElementById('main-confetti-container') || document.body;
                
                for (let i = 0; i < confettiCount; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.style.position = 'fixed';
                        confetti.style.width = Math.random() * 14 + 8 + 'px';
                        confetti.style.height = Math.random() * 14 + 8 + 'px';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.top = '-30px';
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '4px';
                        confetti.style.opacity = '0.95';
                        confetti.style.zIndex = '99999';
                        confetti.style.pointerEvents = 'none';
                        
                        const rotation = Math.random() * 360;
                        const duration = Math.random() * 2.5 + 2.5;
                        const drift = (Math.random() - 0.5) * 150;
                        
                        confetti.style.animation = `confettiDrop ${duration}s linear forwards`;
                        confetti.style.transform = `rotate(${rotation}deg)`;
                        
                        container.appendChild(confetti);
                        
                        confetti.animate([
                            { transform: `translateY(0) translateX(0) rotate(${rotation}deg)`, opacity: 0.95 },
                            { transform: `translateY(${window.innerHeight + 100}px) translateX(${drift}px) rotate(${rotation + 1080}deg)`, opacity: 0 }
                        ], {
                            duration: duration * 1000,
                            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                        });
                        
                        setTimeout(() => confetti.remove(), duration * 1000);
                    }, i * 30);
                }
            },
            
            triggerCompletionConfetti: function() {
                const colors = ['#3b82f6', '#1e3a8a', '#f59e0b', '#60a5fa', '#8b5cf6', '#ec4899', '#ef4444'];
                const confettiCount = 80;
                const container = document.body;
                
                for (let i = 0; i < confettiCount; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.style.position = 'fixed';
                        confetti.style.width = Math.random() * 12 + 6 + 'px';
                        confetti.style.height = Math.random() * 12 + 6 + 'px';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.top = '-20px';
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '3px';
                        confetti.style.opacity = '0.9';
                        confetti.style.zIndex = '99999';
                        confetti.style.pointerEvents = 'none';
                        
                        const rotation = Math.random() * 360;
                        const duration = Math.random() * 2 + 2;
                        const drift = (Math.random() - 0.5) * 100;
                        
                        confetti.style.animation = `confettiDrop ${duration}s linear forwards`;
                        confetti.style.transform = `rotate(${rotation}deg)`;
                        
                        container.appendChild(confetti);
                        
                        confetti.animate([
                            { transform: `translateY(0) translateX(0) rotate(${rotation}deg)`, opacity: 0.9 },
                            { transform: `translateY(${window.innerHeight + 50}px) translateX(${drift}px) rotate(${rotation + 720}deg)`, opacity: 0 }
                        ], {
                            duration: duration * 1000,
                            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                        });
                        
                        setTimeout(() => confetti.remove(), duration * 1000);
                    }, i * 25);
                }
            },
            
            // Prop 50 Supplement Functions
            startProp50: function() {
                // Hide the invitation
                const invitation = document.querySelector('.prop50-invitation');
                if (invitation) {
                    invitation.style.display = 'none';
                }
                
                // Initialize prop50 sequence (12 comprehensive questions)
                this.prop50Sequence = [
                    'prop50-q1', 'prop50-q2', 'prop50-q3', 'prop50-q4',
                    'prop50-q5', 'prop50-q6', 'prop50-q7', 'prop50-q8', 
                    'prop50-q9', 'prop50-q10', 'prop50-q11', 'prop50-q12', 
                    'prop50-complete'
                ];
                this.prop50CurrentPage = 0;
                this.responses.prop50_started = true;
                
                // Show first prop50 question
                setTimeout(() => {
                    this.showPage('prop50-q1');
                }, 400);
            },
            
            showPage: function(pageId) {
                const pages = document.querySelectorAll('.page');
                pages.forEach(page => page.classList.add('hidden'));
                
                const targetPage = document.getElementById(`page-${pageId}`);
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                    window.scrollTo(0, 0);
                    
                    // Removed momentum notification for smooth continuous flow
                    
                    // Trigger confetti and auto-show rating on prop50-complete
                    if (pageId === 'prop50-complete') {
                        this.triggerConfetti();
                        this.calculateTotalTime();
                        
                        // Auto-show rating section after 2 seconds
                        setTimeout(() => {
                            const ratingSection = document.getElementById('rating-section-prop50');
                            if (ratingSection) {
                                ratingSection.style.display = 'block';
                            }
                        }, 2000);
                    }
                }
            },
            
            triggerConfetti: function() {
                const container = document.getElementById('confetti-container');
                if (!container) return;
                
                const colors = ['#f59e0b', '#ef4444', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'];
                const confettiCount = 50;
                
                for (let i = 0; i < confettiCount; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.style.position = 'absolute';
                        confetti.style.width = '10px';
                        confetti.style.height = '10px';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.top = '-20px';
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                        confetti.style.animation = `confettiFall ${2 + Math.random() * 2}s linear forwards`;
                        confetti.style.opacity = '1';
                        
                        container.appendChild(confetti);
                        
                        setTimeout(() => confetti.remove(), 4000);
                    }, i * 30);
                }
            },
            
            calculateTotalTime: function() {
                const totalMinutes = Math.ceil((Date.now() - this.startTime) / 60000);
                const timeEl = document.getElementById('total-completion-time');
                if (timeEl) {
                    timeEl.textContent = totalMinutes;
                }
            },
            
            
            updateProgress: function() {
                const totalQuestions = 20; // All survey questions (including q7a)
                const answeredQuestions = Object.keys(this.responses).filter(k => k.startsWith('q')).length;
                const percentage = Math.round((answeredQuestions / totalQuestions) * 100);
                const currentQuestionNum = answeredQuestions + 1;
                
                const progressBar = document.getElementById('progressBar');
                const oldPercentage = parseInt(progressBar.style.width) || 0;
                progressBar.style.width = percentage + '%';
                
                // Update progress text with percentage + encouragement
                const progressText = document.getElementById('progressText');
                const questionsRemaining = totalQuestions - answeredQuestions;
                const currentPageId = this.pageSequence[this.currentPage];
                
                // Simple, consistent progress display - no urgency messages that break concentration
                if (currentPageId === 'thankyou' || answeredQuestions >= totalQuestions) {
                    progressText.innerHTML = `<i class="fas fa-check-circle" style="margin-right: 6px;"></i>Complete!`;
                    progressText.style.color = '#3b82f6';
                    progressText.style.fontWeight = '700';
                } else {
                    progressText.textContent = `${percentage}% Complete`;
                    progressText.style.color = '';
                    progressText.style.fontWeight = '600';
                }
                
                // Flash progress text on each answer for micro-achievement
                if (percentage > oldPercentage) {
                    progressText.style.transform = 'scale(1.1)';
                    progressText.style.transition = 'transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1)';
                    setTimeout(() => {
                        progressText.style.transform = 'scale(1)';
                    }, 200);
                }
                
                // Smooth, uninterrupted progress - no distracting popups
                
                // Complete survey when reaching thank you page
                if (this.pageSequence[this.currentPage] === 'thankyou') {
                    this.responses.completed = true;
                    this.responses.completionTime = Date.now() - this.startTime;
                    this.saveResults();
                    
                    // CONFETTI on main thank you!
                    this.triggerMainConfetti();
                    
                    // Smooth completion - no chunky effects
                    
                    // Hide progress indicators on thank you page for cleaner look
                    setTimeout(() => {
                        document.getElementById('progressText').style.opacity = '0';
                        document.querySelector('.progress-bar-container').style.opacity = '0';
                    }, 600);
                    
                    // Display completion time with animation
                    const minutes = Math.round(this.responses.completionTime / 60000);
                    const displayMinutes = minutes < 1 ? '<1' : minutes;
                    setTimeout(() => {
                        const timeEl = document.getElementById('completion-time');
                        if (timeEl) {
                            timeEl.textContent = displayMinutes;
                            timeEl.style.animation = 'bounceIn 0.6s ease-out';
                        }
                    }, 100);
                }
            },
            
            saveProgress: function() {
                try {
                    const data = {
                        currentPage: this.currentPage,
                        responses: this.responses,
                        startTime: this.startTime,
                        questionOrder: this.questionOrder,
                        pageSequence: this.pageSequence
                    };
                    localStorage.setItem('survey_progress', JSON.stringify(data));
                } catch (error) {
                    log.error('Failed to save progress:', error.message);
                    // Survey continues to work even if localStorage fails
                }
            },
            
            loadProgress: function() {
                const saved = localStorage.getItem('survey_progress');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        // Only restore if survey wasn't completed
                        if (!data.responses.completed) {
                            this.currentPage = data.currentPage;
                            this.responses = data.responses;
                            this.startTime = data.startTime;
                            this.questionOrder = data.questionOrder || [];
                            this.pageSequence = data.pageSequence || this.pageSequence;
                            
                            // Restore checked radio buttons
                            Object.keys(this.responses).forEach(question => {
                                const answer = this.responses[question].answer;
                                const radio = document.querySelector(`input[name="${question}"][value="${answer}"]`);
                                if (radio) radio.checked = true;
                            });
                        }
                    } catch (e) {
                        log.error('Error loading progress:', e);
                    }
                }
            },
            
            saveResults: function() {
                // Get IP address (will need backend for actual IP, using placeholder)
                const ipAddress = this.getClientIP();
                
                // Save to localStorage
                const results = {
                    ...this.responses,
                    sessionId: this.generateSessionId(),
                    completedAt: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    screenWidth: window.screen.width,
                    screenHeight: window.screen.height,
                    questionOrder: this.questionOrder,
                    ipAddress: ipAddress,
                    referrer: document.referrer || 'direct'
                };
                
                // Get all previous results
                let allResults = [];
                const saved = localStorage.getItem('survey_results');
                if (saved) {
                    try {
                        allResults = JSON.parse(saved);
                    } catch (e) {
                        allResults = [];
                    }
                }
                
                // Add new result
                allResults.push(results);
                
                try {
                    localStorage.setItem('survey_results', JSON.stringify(allResults));
                } catch (error) {
                    log.error('Failed to save results to localStorage:', error.message);
                    // Continue with download even if localStorage fails
                }
                
                // Also save as downloadable JSON
                this.triggerDownload(results);
                
                log.info('Survey response saved:', results);
            },
            
            generateSessionId: function() {
                return 'survey_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            },
            
            getClientIP: async function() {
                // This will capture the client IP on the frontend
                // For production, you'd capture this server-side
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 second timeout
                    
                    const response = await fetch('https://api.ipify.org?format=json', {
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error('IP fetch failed');
                    }
                    
                    const data = await response.json();
                    return data.ip || 'unavailable';
                } catch (error) {
                    log.warn('Could not fetch IP address:', error.message);
                    return 'unavailable';
                }
            },
            
            triggerDownload: function(data) {
                // Create downloadable JSON file
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `survey_response_${data.sessionId}.json`;
                // Uncomment the next line to auto-download
                // a.click();
                URL.revokeObjectURL(url);
            },
            
            exportAllResults: function() {
                const saved = localStorage.getItem('survey_results');
                if (saved) {
                    // Parse and structure data for analysis
                    const rawData = JSON.parse(saved);
                    
                    const structuredData = {
                        metadata: {
                            exportDate: new Date().toISOString(),
                            totalResponses: Array.isArray(rawData) ? rawData.length : 1,
                            surveyVersion: "2.0",
                            includes_prop50: rawData.some ? rawData.some(r => r.prop50_started) : rawData.prop50_started
                        },
                        responses: Array.isArray(rawData) ? rawData : [rawData],
                        summary: this.generateDataSummary(Array.isArray(rawData) ? rawData : [rawData])
                    };
                    
                    const blob = new Blob([JSON.stringify(structuredData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    a.download = `survey_results_${timestamp}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                }
            },
            
            generateDataSummary: function(responses) {
                const summary = {
                    mainSurvey: {
                        completed: responses.filter(r => r.completed).length,
                        screenedOut: responses.filter(r => r.screenout).length,
                        averageTime: 0
                    },
                    prop50: {
                        optInRate: 0,
                        completed: 0,
                        declined: responses.filter(r => r.prop50_declined).length
                    }
                };
                
                // Calculate average completion time
                const completedWithTime = responses.filter(r => r.completed && r.completionTime);
                if (completedWithTime.length > 0) {
                    const totalTime = completedWithTime.reduce((sum, r) => sum + r.completionTime, 0);
                    summary.mainSurvey.averageTime = Math.round(totalTime / completedWithTime.length / 1000) + 's';
                }
                
                // Prop 50 metrics
                const prop50Started = responses.filter(r => r.prop50_started).length;
                if (responses.length > 0) {
                    summary.prop50.optInRate = Math.round((prop50Started / responses.length) * 100) + '%';
                }
                
                return summary;
            }
        };
        
        // Initialize survey on page load
        document.addEventListener('DOMContentLoaded', function() {
            survey.init();
        });
        
        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.activeElement.tagName === 'INPUT') {
                document.activeElement.click();
            }
        });
        
        // Warn before leaving if survey in progress
        window.addEventListener('beforeunload', function(e) {
            if (Object.keys(survey.responses).length > 0 && !survey.responses.completed) {
                e.preventDefault();
                e.returnValue = 'You have a survey in progress. Are you sure you want to leave?';
                return e.returnValue;
            }
        });
        
        // Developer Tools
        const devTools = {
            reset: function() {
                const modal = document.getElementById('reset-modal');
                if (modal) {
                    modal.classList.add('active');
                }
            },
            
            cancelReset: function() {
                const modal = document.getElementById('reset-modal');
                if (modal) {
                    modal.classList.remove('active');
                }
            },
            
            confirmReset: function() {
                localStorage.clear();
                location.reload(true); // Force reload from server, not cache
            },
            
            exportData: function() {
                survey.exportAllResults();
            },
            
            viewData: function() {
                const saved = localStorage.getItem('survey_results');
                if (saved) {
                    log.info('All Survey Results:', JSON.parse(saved));
                } else {
                    log.info('No survey results found');
                }
            }
        };
        
        // Development mode helpers
        if (DEBUG) {
            log.info('Survey System Ready - Development Mode');
            log.info('Dev Tools Available:');
            log.info('- devTools.reset() - Clear all data and restart');
            log.info('- devTools.exportData() - Export all results');
            log.info('- devTools.viewData() - View all data in console');
            log.info('- survey.exportAllResults() - Download all results as JSON');
        }
    </script>
</body>
</html>
